"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ReversoTranslator = void 0;

var _BaseTranslator = require("../../util/BaseTranslator");

var _Multiplexor = require("../../lib/Multiplexor");

var _fetchResponseToJson = require("../../lib/fetchResponseToJson");

var __extends = void 0 && (void 0).__extends || function () {
  var extendStatics = function (d, b) {
    extendStatics = Object.setPrototypeOf || {
      __proto__: []
    } instanceof Array && function (d, b) {
      d.__proto__ = b;
    } || function (d, b) {
      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];
    };

    return extendStatics(d, b);
  };

  return function (d, b) {
    if (typeof b !== "function" && b !== null) throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
    extendStatics(d, b);

    function __() {
      this.constructor = d;
    }

    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
  };
}();

var __assign = void 0 && (void 0).__assign || function () {
  __assign = Object.assign || function (t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
      s = arguments[i];

      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
    }

    return t;
  };

  return __assign.apply(this, arguments);
};

/**
 * This module did not test too ago
 */
var ReversoTranslator =
/** @class */
function (_super) {
  __extends(ReversoTranslator, _super);

  function ReversoTranslator() {
    var _this = _super !== null && _super.apply(this, arguments) || this;

    _this.langMap = {
      en: 'eng',
      ar: 'ara',
      nl: 'dut',
      he: 'heb',
      es: 'spa',
      it: 'ita',
      zh: 'chi',
      de: 'ger',
      pl: 'pol',
      pt: 'por',
      ro: 'rum',
      ru: 'rus',
      tr: 'tur',
      fr: 'fra',
      ja: 'jpn'
    };
    _this.mtp = new _Multiplexor.Multiplexor({
      tokenStart: '<',
      tokenEnd: '>'
    });
    return _this;
  }

  ReversoTranslator.isSupportedAutoFrom = function () {
    return false;
  };

  ReversoTranslator.getSupportedLanguages = function () {
    // eslint-disable
    // prettier-ignore
    return ['en', 'ar', 'nl', 'he', 'es', 'it', 'zh', 'de', 'pl', 'pt', 'ro', 'ru', 'tr', 'fr', 'ja']; // eslint-enable
  };

  ReversoTranslator.prototype.getLengthLimit = function () {
    return 5000;
  };

  ReversoTranslator.prototype.getRequestsTimeout = function () {
    return 1000;
  };

  ReversoTranslator.prototype.checkLimitExceeding = function (text) {
    if (Array.isArray(text)) {
      var encodedText = this.mtp.encode(text.map(function (text, id) {
        return {
          text: text,
          id: '' + id
        };
      }));
      var extra = encodedText.length - this.getLengthLimit();
      return extra > 0 ? extra : 0;
    } else {
      var extra = text.length - this.getLengthLimit();
      return extra > 0 ? extra : 0;
    }
  };

  ReversoTranslator.prototype.translate = function (text, from, to) {
    var localFrom = this.langMap[from];
    var localTo = this.langMap[to];
    var data = {
      input: text,
      from: localFrom,
      to: localTo,
      format: 'text',
      options: {
        origin: 'reversodesktop',
        sentenceSplitter: true,
        contextResults: true,
        languageDetection: false
      }
    };
    return fetch(this.wrapUrlToCorsProxy('https://api.reverso.net/translate/v1/translation'), {
      method: 'POST',
      headers: __assign({
        'Content-Type': 'application/json; charset=utf-8'
      }, this.options.headers),
      body: JSON.stringify(data)
    }).then(_fetchResponseToJson.fetchResponseToJson).then(function (response) {
      if (!(response instanceof Object) || !(response.translation instanceof Array) || response.translation.every(function (i) {
        return typeof i !== 'string';
      })) {
        throw new Error('Unexpected response');
      }

      return response.translation.join('');
    });
  };

  ReversoTranslator.prototype.translateBatch = function (text, langFrom, langTo) {
    var _this = this;

    var encodedText = this.mtp.encode(text.map(function (text, id) {
      return {
        text: text,
        id: '' + id
      };
    }));
    return this.translate(encodedText, langFrom, langTo).then(function (rawTranslate) {
      var result = Array(text.length);

      var decodedMap = _this.mtp.decode(rawTranslate);

      decodedMap.forEach(function (_a) {
        var id = _a.id,
            text = _a.text;
        var index = +id;
        result[index] = text;
      });
      return result;
    });
  };

  ReversoTranslator.translatorName = 'ReversoTranslator (public)';
  return ReversoTranslator;
}(_BaseTranslator.BaseTranslator);

exports.ReversoTranslator = ReversoTranslator;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyYW5zbGF0b3JzL3Vuc3RhYmxlL1JldmVyc29UcmFuc2xhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQTs7QUFFRztBQUNILElBQUEsaUJBQUE7QUFBQTtBQUFBLFVBQUEsTUFBQSxFQUFBO0FBQXVDLEVBQUEsU0FBQSxDQUFBLGlCQUFBLEVBQUEsTUFBQSxDQUFBOztBQUF2QyxXQUFBLGlCQUFBLEdBQUE7QUFBQSxRQUFBLEtBQUEsR0FBQSxNQUFBLEtBQUEsSUFBQSxJQUFBLE1BQUEsQ0FBQSxLQUFBLENBQUEsSUFBQSxFQUFBLFNBQUEsQ0FBQSxJQUFBLElBQUE7O0FBc0NTLElBQUEsS0FBQSxDQUFBLE9BQUEsR0FBa0M7QUFDekMsTUFBQSxFQUFFLEVBQUUsS0FEcUM7QUFFekMsTUFBQSxFQUFFLEVBQUUsS0FGcUM7QUFHekMsTUFBQSxFQUFFLEVBQUUsS0FIcUM7QUFJekMsTUFBQSxFQUFFLEVBQUUsS0FKcUM7QUFLekMsTUFBQSxFQUFFLEVBQUUsS0FMcUM7QUFNekMsTUFBQSxFQUFFLEVBQUUsS0FOcUM7QUFPekMsTUFBQSxFQUFFLEVBQUUsS0FQcUM7QUFRekMsTUFBQSxFQUFFLEVBQUUsS0FScUM7QUFTekMsTUFBQSxFQUFFLEVBQUUsS0FUcUM7QUFVekMsTUFBQSxFQUFFLEVBQUUsS0FWcUM7QUFXekMsTUFBQSxFQUFFLEVBQUUsS0FYcUM7QUFZekMsTUFBQSxFQUFFLEVBQUUsS0FacUM7QUFhekMsTUFBQSxFQUFFLEVBQUUsS0FicUM7QUFjekMsTUFBQSxFQUFFLEVBQUUsS0FkcUM7QUFlekMsTUFBQSxFQUFFLEVBQUU7QUFmcUMsS0FBbEM7QUE0RFMsSUFBQSxLQUFBLENBQUEsR0FBQSxHQUFNLElBQUksd0JBQUosQ0FBZ0I7QUFBRSxNQUFBLFVBQVUsRUFBRSxHQUFkO0FBQW1CLE1BQUEsUUFBUSxFQUFF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LE9BSEQ7QUFLQSxhQUFPLE1BQVA7QUFDQSxLQVZNLENBQVA7QUFXQSxHQWhCTTs7QUFsR2dCLEVBQUEsaUJBQUEsQ0FBQSxjQUFBLEdBQWlCLDRCQUFqQjtBQW1IeEIsU0FBQSxpQkFBQTtBQUFDLENBcEhELENBQXVDLDhCQUF2QyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbGFuZ0NvZGUgfSBmcm9tICcuLi8uLi90eXBlcy9UcmFuc2xhdG9yJztcbmltcG9ydCB7IEJhc2VUcmFuc2xhdG9yIH0gZnJvbSAnLi4vLi4vdXRpbC9CYXNlVHJhbnNsYXRvcic7XG5pbXBvcnQgeyBNdWx0aXBsZXhvciB9IGZyb20gJy4uLy4uL2xpYi9NdWx0aXBsZXhvcic7XG5pbXBvcnQgeyBmZXRjaFJlc3BvbnNlVG9Kc29uIH0gZnJvbSAnLi4vLi4vbGliL2ZldGNoUmVzcG9uc2VUb0pzb24nO1xuXG4vKipcbiAqIFRoaXMgbW9kdWxlIGRpZCBub3QgdGVzdCB0b28gYWdvXG4gKi9cbmV4cG9ydCBjbGFzcyBSZXZlcnNvVHJhbnNsYXRvciBleHRlbmRzIEJhc2VUcmFuc2xhdG9yIHtcblx0cHVibGljIHN0YXRpYyByZWFkb25seSB0cmFuc2xhdG9yTmFtZSA9ICdSZXZlcnNvVHJhbnNsYXRvciAocHVibGljKSc7XG5cblx0cHVibGljIHN0YXRpYyBpc1N1cHBvcnRlZEF1dG9Gcm9tKCkge1xuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdHB1YmxpYyBzdGF0aWMgZ2V0U3VwcG9ydGVkTGFuZ3VhZ2VzKCk6IGxhbmdDb2RlW10ge1xuXHRcdC8vIGVzbGludC1kaXNhYmxlXG5cdFx0Ly8gcHJldHRpZXItaWdub3JlXG5cdFx0cmV0dXJuIFtcblx0XHRcdCdlbicsICdhcicsICdubCcsICdoZScsICdlcycsICdpdCcsICd6aCcsICdkZScsICdwbCcsICdwdCcsXG5cdFx0XHQncm8nLCAncnUnLCAndHInLCAnZnInLCAnamEnLFxuXHRcdF07XG5cdFx0Ly8gZXNsaW50LWVuYWJsZVxuXHR9XG5cblx0cHVibGljIGdldExlbmd0aExpbWl0KCkge1xuXHRcdHJldHVybiA1MDAwO1xuXHR9XG5cblx0cHVibGljIGdldFJlcXVlc3RzVGltZW91dCgpIHtcblx0XHRyZXR1cm4gMTAwMDtcblx0fVxuXG5cdHB1YmxpYyBjaGVja0xpbWl0RXhjZWVkaW5nKHRleHQ6IHN0cmluZyB8IHN0cmluZ1tdKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkodGV4dCkpIHtcblx0XHRcdGNvbnN0IGVuY29kZWRUZXh0ID0gdGhpcy5tdHAuZW5jb2RlKFxuXHRcdFx0XHR0ZXh0Lm1hcCgodGV4dCwgaWQpID0+ICh7IHRleHQsIGlkOiAnJyArIGlkIH0pKSxcblx0XHRcdCk7XG5cdFx0XHRjb25zdCBleHRyYSA9IGVuY29kZWRUZXh0Lmxlbmd0aCAtIHRoaXMuZ2V0TGVuZ3RoTGltaXQoKTtcblx0XHRcdHJldHVybiBleHRyYSA+IDAgPyBleHRyYSA6IDA7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnN0IGV4dHJhID0gdGV4dC5sZW5ndGggLSB0aGlzLmdldExlbmd0aExpbWl0KCk7XG5cdFx0XHRyZXR1cm4gZXh0cmEgPiAwID8gZXh0cmEgOiAwO1xuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgbGFuZ01hcDogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcblx0XHRlbjogJ2VuZycsXG5cdFx0YXI6ICdhcmEnLFxuXHRcdG5sOiAnZHV0Jyxcblx0XHRoZTogJ2hlYicsXG5cdFx0ZXM6ICdzcGEnLFxuXHRcdGl0OiAnaXRhJyxcblx0XHR6aDogJ2NoaScsXG5cdFx0ZGU6ICdnZXInLFxuXHRcdHBsOiAncG9sJyxcblx0XHRwdDogJ3BvcicsXG5cdFx0cm86ICdydW0nLFxuXHRcdHJ1OiAncnVzJyxcblx0XHR0cjogJ3R1cicsXG5cdFx0ZnI6ICdmcmEnLFxuXHRcdGphOiAnanBuJyxcblx0fTtcblxuXHRwdWJsaWMgdHJhbnNsYXRlKHRleHQ6IHN0cmluZywgZnJvbTogbGFuZ0NvZGUsIHRvOiBsYW5nQ29kZSkge1xuXHRcdGNvbnN0IGxvY2FsRnJvbSA9IHRoaXMubGFuZ01hcFtmcm9tXTtcblx0XHRjb25zdCBsb2NhbFRvID0gdGhpcy5sYW5nTWFwW3RvXTtcblxuXHRcdGNvbnN0IGRhdGEgPSB7XG5cdFx0XHRpbnB1dDogdGV4dCxcblx0XHRcdGZyb206IGxvY2FsRnJvbSxcblx0XHRcdHRvOiBsb2NhbFRvLFxuXHRcdFx0Zm9ybWF0OiAndGV4dCcsXG5cdFx0XHRvcHRpb25zOiB7XG5cdFx0XHRcdG9yaWdpbjogJ3JldmVyc29kZXNrdG9wJyxcblx0XHRcdFx0c2VudGVuY2VTcGxpdHRlcjogdHJ1ZSxcblx0XHRcdFx0Y29udGV4dFJlc3VsdHM6IHRydWUsXG5cdFx0XHRcdGxhbmd1YWdlRGV0ZWN0aW9uOiBmYWxzZSxcblx0XHRcdH0sXG5cdFx0fTtcblxuXHRcdHJldHVybiBmZXRjaChcblx0XHRcdHRoaXMud3JhcFVybFRvQ29yc1Byb3h5KCdodHRwczovL2FwaS5yZXZlcnNvLm5ldC90cmFuc2xhdGUvdjEvdHJhbnNsYXRpb24nKSxcblx0XHRcdHtcblx0XHRcdFx0bWV0aG9kOiAnUE9TVCcsXG5cdFx0XHRcdGhlYWRlcnM6IHtcblx0XHRcdFx0XHQnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgnLFxuXHRcdFx0XHRcdC4uLnRoaXMub3B0aW9ucy5oZWFkZXJzLFxuXHRcdFx0XHR9LFxuXHRcdFx0XHRib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKSxcblx0XHRcdH0sXG5cdFx0KVxuXHRcdFx0LnRoZW4oZmV0Y2hSZXNwb25zZVRvSnNvbilcblx0XHRcdC50aGVuKChyZXNwb25zZSkgPT4ge1xuXHRcdFx0XHRpZiAoXG5cdFx0XHRcdFx0IShyZXNwb25zZSBpbnN0YW5jZW9mIE9iamVjdCkgfHxcblx0XHRcdFx0XHQhKHJlc3BvbnNlLnRyYW5zbGF0aW9uIGluc3RhbmNlb2YgQXJyYXkpIHx8XG5cdFx0XHRcdFx0cmVzcG9uc2UudHJhbnNsYXRpb24uZXZlcnkoKGk6IGFueSkgPT4gdHlwZW9mIGkgIT09ICdzdHJpbmcnKVxuXHRcdFx0XHQpIHtcblx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ1VuZXhwZWN0ZWQgcmVzcG9uc2UnKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiAocmVzcG9uc2UudHJhbnNsYXRpb24gYXMgc3RyaW5nW10pLmpvaW4oJycpO1xuXHRcdFx0fSk7XG5cdH1cblxuXHRwcml2YXRlIHJlYWRvbmx5IG10cCA9IG5ldyBNdWx0aXBsZXhvcih7IHRva2VuU3RhcnQ6ICc8JywgdG9rZW5FbmQ6ICc+JyB9KTtcblx0cHVibGljIHRyYW5zbGF0ZUJhdGNoKHRleHQ6IHN0cmluZ1tdLCBsYW5nRnJvbTogbGFuZ0NvZGUsIGxhbmdUbzogbGFuZ0NvZGUpIHtcblx0XHRjb25zdCBlbmNvZGVkVGV4dCA9IHRoaXMubXRwLmVuY29kZShcblx0XHRcdHRleHQubWFwKCh0ZXh0LCBpZCkgPT4gKHsgdGV4dCwgaWQ6ICcnICsgaWQgfSkpLFxuXHRcdCk7XG5cblx0XHRyZXR1cm4gdGhpcy50cmFuc2xhdGUoZW5jb2RlZFRleHQsIGxhbmdGcm9tLCBsYW5nVG8pLnRoZW4oKHJhd1RyYW5zbGF0ZSkgPT4ge1xuXHRcdFx0Y29uc3QgcmVzdWx0ID0gQXJyYXk8c3RyaW5nIHwgbnVsbD4odGV4dC5sZW5ndGgpO1xuXG5cdFx0XHRjb25zdCBkZWNvZGVkTWFwID0gdGhpcy5tdHAuZGVjb2RlKHJhd1RyYW5zbGF0ZSk7XG5cdFx0XHRkZWNvZGVkTWFwLmZvckVhY2goKHsgaWQsIHRleHQgfSkgPT4ge1xuXHRcdFx0XHRjb25zdCBpbmRleCA9ICtpZDtcblx0XHRcdFx0cmVzdWx0W2luZGV4XSA9IHRleHQ7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIHJlc3VsdDtcblx0XHR9KTtcblx0fVxufVxuIl0sImZpbGUiOiJ0cmFuc2xhdG9ycy91bnN0YWJsZS9SZXZlcnNvVHJhbnNsYXRvci5qcyJ9
