"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.GoogleTranslatorTokenFree = exports.GoogleTranslator = exports.AbstractGoogleTranslator = void 0;

var _axios = _interopRequireDefault(require("axios"));

var _queryString = require("query-string");

var _xpath = _interopRequireDefault(require("xpath"));

var _xmldom = require("@xmldom/xmldom");

var _BaseTranslator = require("../../util/BaseTranslator");

var _token = require("./token");

var _utils = require("./utils");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var __extends = void 0 && (void 0).__extends || function () {
  var extendStatics = function (d, b) {
    extendStatics = Object.setPrototypeOf || {
      __proto__: []
    } instanceof Array && function (d, b) {
      d.__proto__ = b;
    } || function (d, b) {
      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];
    };

    return extendStatics(d, b);
  };

  return function (d, b) {
    if (typeof b !== "function" && b !== null) throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
    extendStatics(d, b);

    function __() {
      this.constructor = d;
    }

    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
  };
}();

var __assign = void 0 && (void 0).__assign || function () {
  __assign = Object.assign || function (t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
      s = arguments[i];

      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
    }

    return t;
  };

  return __assign.apply(this, arguments);
};

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  function adopt(value) {
    return value instanceof P ? value : new P(function (resolve) {
      resolve(value);
    });
  }

  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

var __generator = void 0 && (void 0).__generator || function (thisArg, body) {
  var _ = {
    label: 0,
    sent: function () {
      if (t[0] & 1) throw t[1];
      return t[1];
    },
    trys: [],
    ops: []
  },
      f,
      y,
      t,
      g;
  return g = {
    next: verb(0),
    "throw": verb(1),
    "return": verb(2)
  }, typeof Symbol === "function" && (g[Symbol.iterator] = function () {
    return this;
  }), g;

  function verb(n) {
    return function (v) {
      return step([n, v]);
    };
  }

  function step(op) {
    if (f) throw new TypeError("Generator is already executing.");

    while (_) try {
      if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
      if (y = 0, t) op = [op[0] & 2, t.value];

      switch (op[0]) {
        case 0:
        case 1:
          t = op;
          break;

        case 4:
          _.label++;
          return {
            value: op[1],
            done: false
          };

        case 5:
          _.label++;
          y = op[1];
          op = [0];
          continue;

        case 7:
          op = _.ops.pop();

          _.trys.pop();

          continue;

        default:
          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _ = 0;
            continue;
          }

          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {
            _.label = op[1];
            break;
          }

          if (op[0] === 6 && _.label < t[1]) {
            _.label = t[1];
            t = op;
            break;
          }

          if (t && _.label < t[2]) {
            _.label = t[2];

            _.ops.push(op);

            break;
          }

          if (t[2]) _.ops.pop();

          _.trys.pop();

          continue;
      }

      op = body.call(thisArg, _);
    } catch (e) {
      op = [6, e];
      y = 0;
    } finally {
      f = t = 0;
    }

    if (op[0] & 5) throw op[1];
    return {
      value: op[0] ? op[1] : void 0,
      done: true
    };
  }
};

var __read = void 0 && (void 0).__read || function (o, n) {
  var m = typeof Symbol === "function" && o[Symbol.iterator];
  if (!m) return o;
  var i = m.call(o),
      r,
      ar = [],
      e;

  try {
    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
  } catch (error) {
    e = {
      error: error
    };
  } finally {
    try {
      if (r && !r.done && (m = i["return"])) m.call(i);
    } finally {
      if (e) throw e.error;
    }
  }

  return ar;
};

/**
 * Common class for google translator implementations
 */
var AbstractGoogleTranslator =
/** @class */
function (_super) {
  __extends(AbstractGoogleTranslator, _super);

  function AbstractGoogleTranslator() {
    var _this = _super !== null && _super.apply(this, arguments) || this;

    _this.langReplacements = {
      zh: 'zh-cn'
    };
    return _this;
  }

  AbstractGoogleTranslator.isSupportedAutoFrom = function () {
    return true;
  };

  AbstractGoogleTranslator.getSupportedLanguages = function () {
    // Supported, but not valid languages ["zh-cn", "zh-tw", 'ceb', 'haw', 'iw', 'hmn', 'jw', 'ma']
    // eslint-disable
    // prettier-ignore
    return ['af', 'sq', 'am', 'ar', 'hy', 'az', 'eu', 'be', 'bn', 'bs', 'bg', 'ca', 'ny', 'co', 'hr', 'cs', 'da', 'nl', 'en', 'eo', 'et', 'tl', 'fi', 'fr', 'fy', 'gl', 'ka', 'de', 'el', 'gu', 'ht', 'ha', 'hi', 'hu', 'is', 'ig', 'id', 'ga', 'it', 'ja', 'kn', 'kk', 'km', 'ko', 'ku', 'ky', 'lo', 'la', 'lv', 'lt', 'lb', 'mk', 'mg', 'ms', 'ml', 'mt', 'mi', 'mr', 'mn', 'my', 'ne', 'no', 'ps', 'fa', 'pl', 'pt', 'pa', 'ro', 'ru', 'sm', 'gd', 'sr', 'st', 'sn', 'sd', 'si', 'sk', 'sl', 'so', 'es', 'su', 'sw', 'sv', 'tg', 'ta', 'te', 'th', 'tr', 'uk', 'ur', 'uz', 'vi', 'cy', 'xh', 'yi', 'yo', 'zu', 'zh']; // eslint-enable
  };

  AbstractGoogleTranslator.prototype.getLengthLimit = function () {
    return 4000;
  };

  AbstractGoogleTranslator.prototype.getRequestsTimeout = function () {
    return 300;
  };

  AbstractGoogleTranslator.prototype.fixLang = function (lang) {
    return lang in this.langReplacements ? this.langReplacements[lang] : lang;
  };

  return AbstractGoogleTranslator;
}(_BaseTranslator.BaseTranslator);

exports.AbstractGoogleTranslator = AbstractGoogleTranslator;

/**
 * Translator implementation which use Google API with token from https://translate.google.com
 */
var GoogleTranslator =
/** @class */
function (_super) {
  __extends(GoogleTranslator, _super);

  function GoogleTranslator() {
    var _this = _super !== null && _super.apply(this, arguments) || this;

    _this.parseXMLResponse = function (text) {
      try {
        var doc = new _xmldom.DOMParser().parseFromString(text);

        var nodes = _xpath.default.select('//pre/*[not(self::i)]//text()', doc);

        return nodes.length === 0 ? null : nodes.map(function (node) {
          return node.toString();
        }).join(' ');
      } catch (err) {
        return null;
      }
    };

    return _this;
  }

  GoogleTranslator.prototype.checkLimitExceeding = function (text) {
    if (Array.isArray(text)) {
      var encodedText = this.encodeForBatch(text).join('');
      var extra = encodedText.length - this.getLengthLimit();
      return extra > 0 ? extra : 0;
    } else {
      var extra = text.length - this.getLengthLimit();
      return extra > 0 ? extra : 0;
    }
  };

  GoogleTranslator.prototype.translate = function (text, from, to) {
    var _this = this;

    return (0, _token.getToken)(text).then(function (_a) {
      var tk = _a.value;
      var apiPath = 'https://translate.google.com/translate_a/single';
      var data = {
        client: 't',
        sl: _this.fixLang(from),
        tl: _this.fixLang(to),
        hl: _this.fixLang(to),
        dt: ['at', 'bd', 'ex', 'ld', 'md', 'qca', 'rw', 'rm', 'ss', 't'],
        ie: 'UTF-8',
        oe: 'UTF-8',
        otf: 1,
        ssel: 0,
        tsel: 0,
        kc: 7,
        q: text,
        tk: tk
      };
      var url = apiPath + '?' + (0, _queryString.stringify)(data);
      return _axios.default.get(_this.wrapUrlToCorsProxy(url), {
        withCredentials: false,
        headers: _this.options.headers
      }).then(function (rsp) {
        return rsp.data;
      }).then(function (rsp) {
        if (!(rsp instanceof Array) || !(rsp[0] instanceof Array)) {
          throw new Error('Unexpected response');
        }

        var translatedText = rsp[0].map(function (chunk) {
          return chunk instanceof Array && typeof chunk[0] === 'string' ? chunk[0] : '';
        }).join('');
        return translatedText;
      });
    });
  };

  GoogleTranslator.prototype.translateBatch = function (text, from, to) {
    var _this = this;

    var preparedText = this.encodeForBatch(text);
    return (0, _token.getToken)(preparedText.join('')).then(function (_a) {
      var tk = _a.value;
      var apiPath = 'https://translate.googleapis.com/translate_a/t';
      var data = {
        anno: 3,
        client: 'te',
        v: '1.0',
        format: 'html',
        sl: _this.fixLang(from),
        tl: _this.fixLang(to),
        tk: tk
      };
      var url = apiPath + '?' + (0, _queryString.stringify)(data);
      var body = preparedText.map(function (text) {
        return "&q=".concat(encodeURIComponent(text));
      }).join('');
      return (0, _axios.default)({
        url: _this.wrapUrlToCorsProxy(url),
        method: 'POST',
        withCredentials: false,
        headers: __assign({
          'Content-Type': 'application/x-www-form-urlencoded'
        }, _this.options.headers),
        data: body
      }).then(function (rsp) {
        return rsp.data;
      }).then(function (rawResp) {
        try {
          if (!Array.isArray(rawResp)) {
            throw new Error('Unexpected response');
          }

          var isSingleResponseMode_1 = text.length === 1;
          var result_1 = [];
          (0, _utils.visitArrayItems)(rawResp, function (obj) {
            if (isSingleResponseMode_1 && result_1.length === 1) return;
            if (typeof obj !== 'string') return;

            if (isSingleResponseMode_1) {
              var parsedText = _this.parseXMLResponse(obj);

              result_1.push(parsedText || obj);
            } else {
              var parsedText = _this.parseXMLResponse(obj);

              if (parsedText !== null) {
                result_1.push(parsedText);
              }
            }
          });

          if (result_1.length !== text.length) {
            throw new Error('Mismatching a lengths of original and translated arrays');
          }

          return result_1;
        } catch (err) {
          console.warn('Got response', rawResp);
          throw err;
        }
      });
    });
  };

  GoogleTranslator.prototype.encodeForBatch = function (textList) {
    return textList.map(function (text, i) {
      return "<pre><a i=\"".concat(i, "\">").concat(text, "</a></pre>");
    });
  };

  GoogleTranslator.translatorName = 'GoogleTranslator';
  return GoogleTranslator;
}(AbstractGoogleTranslator);

exports.GoogleTranslator = GoogleTranslator;

/**
 * Translator implementation which use Google API without token
 */
var GoogleTranslatorTokenFree =
/** @class */
function (_super) {
  __extends(GoogleTranslatorTokenFree, _super);

  function GoogleTranslatorTokenFree() {
    var _this = _super !== null && _super.apply(this, arguments) || this;

    _this.translate = function (text, from, to) {
      return __awaiter(_this, void 0, void 0, function () {
        var _a, translation;

        return __generator(this, function (_b) {
          switch (_b.label) {
            case 0:
              return [4
              /*yield*/
              , this.translateBatch([text], from, to)];

            case 1:
              _a = __read.apply(void 0, [_b.sent(), 1]), translation = _a[0];
              return [2
              /*return*/
              , translation];
          }
        });
      });
    };

    return _this;
  }

  GoogleTranslatorTokenFree.prototype.translateBatch = function (text, from, to) {
    var apiPath = 'https://translate.googleapis.com/translate_a/t';
    var data = {
      client: 'dict-chrome-ex',
      sl: this.fixLang(from),
      tl: this.fixLang(to),
      q: text
    };
    var url = apiPath + '?' + (0, _queryString.stringify)(data);
    return (0, _axios.default)({
      url: this.wrapUrlToCorsProxy(url),
      method: 'GET',
      withCredentials: false,
      headers: __assign({
        'Content-Type': 'application/x-www-form-urlencoded'
      }, this.options.headers)
    }).then(function (rsp) {
      return rsp.data;
    }).then(function (rawResp) {
      try {
        if (!Array.isArray(rawResp)) {
          throw new Error('Unexpected response');
        }

        var intermediateTextsArray_1 = [];
        (0, _utils.visitArrayItems)(rawResp, function (obj) {
          if (typeof obj === 'string') {
            intermediateTextsArray_1.push(obj);
          }
        });
        var result = [];
        var isSingleResponseMode = text.length === 1;
        var isOneToOneMappingMode = intermediateTextsArray_1.length === text.length;

        for (var idx in intermediateTextsArray_1) {
          var text_1 = intermediateTextsArray_1[idx];

          if (isSingleResponseMode) {
            result.push(text_1);
            break;
          } // Each second text it's not translation if not 1-1 mapping


          var isTranslation = isOneToOneMappingMode || Number(idx) % 2 === 0;

          if (isTranslation) {
            result.push(text_1);
          }
        }

        if (result.length !== text.length) {
          console.warn('Translation result', result);
          throw new Error('Mismatching a lengths of original and translated arrays');
        }

        return result;
      } catch (err) {
        console.warn('Got response', rawResp);
        throw err;
      }
    });
  };

  GoogleTranslatorTokenFree.translatorName = 'GoogleTranslatorTokenFree';
  return GoogleTranslatorTokenFree;
}(AbstractGoogleTranslator);

exports.GoogleTranslatorTokenFree = GoogleTranslatorTokenFree;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyYW5zbGF0b3JzL0dvb2dsZVRyYW5zbGF0b3IvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUdBOztBQUNBOztBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBOztBQUVHO0FBQ0gsSUFBQSx3QkFBQTtBQUFBO0FBQUEsVUFBQSxNQUFBLEVBQUE7QUFBdUQsRUFBQSxTQUFBLENBQUEsd0JBQUEsRUFBQSxNQUFBLENBQUE7O0FBQXZELFdBQUEsd0JBQUEsR0FBQTtBQUFBLFFBQUEsS0FBQSxHQUFBLE1BQUEsS0FBQSxJQUFBLElBQUEsTUFBQSxDQUFBLEtBQUEsQ0FBQSxJQUFBLEVBQUEsU0FBQSxDQUFBLElBQUEsSUFBQTs7QUFpQ29CLElBQUEsS0FBQSxDQUFBLGdCQUFBLEdBQTJDO0FBQzdELE1BQUEsRUFBRSxFQUFFO0FBRHlELEtBQTNDOztBQU9uQjs7QUF2Q2MsRUFBQSx3QkFBQSxDQUFBLG1CQUFBLEdBQWQsWUFBQTtBQUNDLFdBQU8sSUFBUDtBQUNBLEdBRmE7O0FBSUEsRUFBQSx3QkFBQSxDQUFBLHFCQUFBLEdBQWQsWUFBQTtBQUNDO0FBRUE7QUFDQTtBQUNBLFdBQU8sQ0FDTixJQURNLEVBQ0EsSUFEQSxFQUNNLElBRE4sRUFDWSxJQURaLEVBQ2tCLElBRGxCLEVBQ3dCLElBRHhCLEVBQzhCLElBRDlCLEVBQ29DLElBRHBDLEVBQzBDLElBRDFDLEVBQ2dELElBRGhELEVBRU4sSUFGTSxFQUVBLElBRkEsRUFFTSxJQUZOLEVBRVks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TUFBTSxDQUFDLE1BQVAsS0FBa0IsSUFBSSxDQUFDLE1BQTNCLEVBQW1DO0FBQ2xDLFVBQUEsT0FBTyxDQUFDLElBQVIsQ0FBYSxvQkFBYixFQUFtQyxNQUFuQztBQUNBLGdCQUFNLElBQUksS0FBSixDQUNMLHlEQURLLENBQU47QUFHQTs7QUFFRCxlQUFPLE1BQVA7QUFDQSxPQXpDRCxDQXlDRSxPQUFPLEdBQVAsRUFBWTtBQUNiLFFBQUEsT0FBTyxDQUFDLElBQVIsQ0FBYSxjQUFiLEVBQTZCLE9BQTdCO0FBQ0EsY0FBTSxHQUFOO0FBQ0E7QUFDRCxLQXhESyxDQUFQO0FBeURBLEdBckVNOztBQVBnQixFQUFBLHlCQUFBLENBQUEsY0FBQSxHQUFpQiwyQkFBakI7QUE2RXhCLFNBQUEseUJBQUE7QUFBQyxDQTlFRCxDQUErQyx3QkFBL0MsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7XG5pbXBvcnQgeyBzdHJpbmdpZnkgfSBmcm9tICdxdWVyeS1zdHJpbmcnO1xuaW1wb3J0IHhwYXRoIGZyb20gJ3hwYXRoJztcbmltcG9ydCB7IERPTVBhcnNlciB9IGZyb20gJ0B4bWxkb20veG1sZG9tJztcblxuaW1wb3J0IHsgbGFuZ0NvZGUsIGxhbmdDb2RlV2l0aEF1dG8gfSBmcm9tICcuLi8uLi90eXBlcy9UcmFuc2xhdG9yJztcbmltcG9ydCB7IEJhc2VUcmFuc2xhdG9yIH0gZnJvbSAnLi4vLi4vdXRpbC9CYXNlVHJhbnNsYXRvcic7XG5pbXBvcnQgeyBnZXRUb2tlbiB9IGZyb20gJy4vdG9rZW4nO1xuaW1wb3J0IHsgdmlzaXRBcnJheUl0ZW1zIH0gZnJvbSAnLi91dGlscyc7XG5cbi8qKlxuICogQ29tbW9uIGNsYXNzIGZvciBnb29nbGUgdHJhbnNsYXRvciBpbXBsZW1lbnRhdGlvbnNcbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEFic3RyYWN0R29vZ2xlVHJhbnNsYXRvciBleHRlbmRzIEJhc2VUcmFuc2xhdG9yIHtcblx0cHVibGljIHN0YXRpYyBpc1N1cHBvcnRlZEF1dG9Gcm9tKCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0cHVibGljIHN0YXRpYyBnZXRTdXBwb3J0ZWRMYW5ndWFnZXMoKTogbGFuZ0NvZGVbXSB7XG5cdFx0Ly8gU3VwcG9ydGVkLCBidXQgbm90IHZhbGlkIGxhbmd1YWdlcyBbXCJ6aC1jblwiLCBcInpoLXR3XCIsICdjZWInLCAnaGF3JywgJ2l3JywgJ2htbicsICdqdycsICdtYSddXG5cblx0XHQvLyBlc2xpbnQtZGlzYWJsZVxuXHRcdC8vIHByZXR0aWVyLWlnbm9yZVxuXHRcdHJldHVybiBbXG5cdFx0XHQnYWYnLCAnc3EnLCAnYW0nLCAnYXInLCAnaHknLCAnYXonLCAnZXUnLCAnYmUnLCAnYm4nLCAnYnMnLFxuXHRcdFx0J2JnJywgJ2NhJywgJ255JywgJ2NvJywgJ2hyJywgJ2NzJywgJ2RhJywgJ25sJywgJ2VuJywgJ2VvJyxcblx0XHRcdCdldCcsICd0bCcsICdmaScsICdmcicsICdmeScsICdnbCcsICdrYScsICdkZScsICdlbCcsICdndScsXG5cdFx0XHQnaHQnLCAnaGEnLCAnaGknLCAnaHUnLCAnaXMnLCAnaWcnLCAnaWQnLCAnZ2EnLCAnaXQnLCAnamEnLFxuXHRcdFx0J2tuJywgJ2trJywgJ2ttJywgJ2tvJywgJ2t1JywgJ2t5JywgJ2xvJywgJ2xhJywgJ2x2JywgJ2x0Jyxcblx0XHRcdCdsYicsICdtaycsICdtZycsICdtcycsICdtbCcsICdtdCcsICdtaScsICdtcicsICdtbicsICdteScsXG5cdFx0XHQnbmUnLCAnbm8nLCAncHMnLCAnZmEnLCAncGwnLCAncHQnLCAncGEnLCAncm8nLCAncnUnLCAnc20nLFxuXHRcdFx0J2dkJywgJ3NyJywgJ3N0JywgJ3NuJywgJ3NkJywgJ3NpJywgJ3NrJywgJ3NsJywgJ3NvJywgJ2VzJyxcblx0XHRcdCdzdScsICdzdycsICdzdicsICd0ZycsICd0YScsICd0ZScsICd0aCcsICd0cicsICd1aycsICd1cicsXG5cdFx0XHQndXonLCAndmknLCAnY3knLCAneGgnLCAneWknLCAneW8nLCAnenUnLCAnemgnLFxuXHRcdF07XG5cdFx0Ly8gZXNsaW50LWVuYWJsZVxuXHR9XG5cblx0cHVibGljIGdldExlbmd0aExpbWl0KCkge1xuXHRcdHJldHVybiA0MDAwO1xuXHR9XG5cblx0cHVibGljIGdldFJlcXVlc3RzVGltZW91dCgpIHtcblx0XHRyZXR1cm4gMzAwO1xuXHR9XG5cblx0cHJvdGVjdGVkIHJlYWRvbmx5IGxhbmdSZXBsYWNlbWVudHM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7XG5cdFx0emg6ICd6aC1jbicsXG5cdH07XG5cblx0cHJvdGVjdGVkIGZpeExhbmcobGFuZzogbGFuZ0NvZGVXaXRoQXV0bykge1xuXHRcdHJldHVybiBsYW5nIGluIHRoaXMubGFuZ1JlcGxhY2VtZW50cyA/IHRoaXMubGFuZ1JlcGxhY2VtZW50c1tsYW5nXSA6IGxhbmc7XG5cdH1cbn1cblxuLyoqXG4gKiBUcmFuc2xhdG9yIGltcGxlbWVudGF0aW9uIHdoaWNoIHVzZSBHb29nbGUgQVBJIHdpdGggdG9rZW4gZnJvbSBodHRwczovL3RyYW5zbGF0ZS5nb29nbGUuY29tXG4gKi9cbmV4cG9ydCBjbGFzcyBHb29nbGVUcmFuc2xhdG9yIGV4dGVuZHMgQWJzdHJhY3RHb29nbGVUcmFuc2xhdG9yIHtcblx0cHVibGljIHN0YXRpYyByZWFkb25seSB0cmFuc2xhdG9yTmFtZSA9ICdHb29nbGVUcmFuc2xhdG9yJztcblxuXHRwdWJsaWMgY2hlY2tMaW1pdEV4Y2VlZGluZyh0ZXh0OiBzdHJpbmcgfCBzdHJpbmdbXSkge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHRleHQpKSB7XG5cdFx0XHRjb25zdCBlbmNvZGVkVGV4dCA9IHRoaXMuZW5jb2RlRm9yQmF0Y2godGV4dCkuam9pbignJyk7XG5cdFx0XHRjb25zdCBleHRyYSA9IGVuY29kZWRUZXh0Lmxlbmd0aCAtIHRoaXMuZ2V0TGVuZ3RoTGltaXQoKTtcblx0XHRcdHJldHVybiBleHRyYSA+IDAgPyBleHRyYSA6IDA7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnN0IGV4dHJhID0gdGV4dC5sZW5ndGggLSB0aGlzLmdldExlbmd0aExpbWl0KCk7XG5cdFx0XHRyZXR1cm4gZXh0cmEgPiAwID8gZXh0cmEgOiAwO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyB0cmFuc2xhdGUodGV4dDogc3RyaW5nLCBmcm9tOiBsYW5nQ29kZVdpdGhBdXRvLCB0bzogbGFuZ0NvZGUpIHtcblx0XHRyZXR1cm4gZ2V0VG9rZW4odGV4dCkudGhlbigoeyB2YWx1ZTogdGsgfSkgPT4ge1xuXHRcdFx0Y29uc3QgYXBpUGF0aCA9ICdodHRwczovL3RyYW5zbGF0ZS5nb29nbGUuY29tL3RyYW5zbGF0ZV9hL3NpbmdsZSc7XG5cblx0XHRcdGNvbnN0IGRhdGEgPSB7XG5cdFx0XHRcdGNsaWVudDogJ3QnLFxuXHRcdFx0XHRzbDogdGhpcy5maXhMYW5nKGZyb20pLFxuXHRcdFx0XHR0bDogdGhpcy5maXhMYW5nKHRvKSxcblx0XHRcdFx0aGw6IHRoaXMuZml4TGFuZyh0byksXG5cdFx0XHRcdGR0OiBbJ2F0JywgJ2JkJywgJ2V4JywgJ2xkJywgJ21kJywgJ3FjYScsICdydycsICdybScsICdzcycsICd0J10sXG5cdFx0XHRcdGllOiAnVVRGLTgnLFxuXHRcdFx0XHRvZTogJ1VURi04Jyxcblx0XHRcdFx0b3RmOiAxLFxuXHRcdFx0XHRzc2VsOiAwLFxuXHRcdFx0XHR0c2VsOiAwLFxuXHRcdFx0XHRrYzogNyxcblx0XHRcdFx0cTogdGV4dCxcblx0XHRcdFx0dGssXG5cdFx0XHR9O1xuXG5cdFx0XHRjb25zdCB1cmwgPSBhcGlQYXRoICsgJz8nICsgc3RyaW5naWZ5KGRhdGEpO1xuXG5cdFx0XHRyZXR1cm4gYXhpb3Ncblx0XHRcdFx0LmdldCh0aGlzLndyYXBVcmxUb0NvcnNQcm94eSh1cmwpLCB7XG5cdFx0XHRcdFx0d2l0aENyZWRlbnRpYWxzOiBmYWxzZSxcblx0XHRcdFx0XHRoZWFkZXJzOiB0aGlzLm9wdGlvbnMuaGVhZGVycyxcblx0XHRcdFx0fSlcblx0XHRcdFx0LnRoZW4oKHJzcCkgPT4gcnNwLmRhdGEpXG5cdFx0XHRcdC50aGVuKChyc3ApID0+IHtcblx0XHRcdFx0XHRpZiAoIShyc3AgaW5zdGFuY2VvZiBBcnJheSkgfHwgIShyc3BbMF0gaW5zdGFuY2VvZiBBcnJheSkpIHtcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcignVW5leHBlY3RlZCByZXNwb25zZScpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGNvbnN0IHRyYW5zbGF0ZWRUZXh0ID0gcnNwWzBdXG5cdFx0XHRcdFx0XHQubWFwKChjaHVuaykgPT5cblx0XHRcdFx0XHRcdFx0Y2h1bmsgaW5zdGFuY2VvZiBBcnJheSAmJiB0eXBlb2YgY2h1bmtbMF0gPT09ICdzdHJpbmcnXG5cdFx0XHRcdFx0XHRcdFx0PyBjaHVua1swXVxuXHRcdFx0XHRcdFx0XHRcdDogJycsXG5cdFx0XHRcdFx0XHQpXG5cdFx0XHRcdFx0XHQuam9pbignJyk7XG5cblx0XHRcdFx0XHRyZXR1cm4gdHJhbnNsYXRlZFRleHQ7XG5cdFx0XHRcdH0pO1xuXHRcdH0pO1xuXHR9XG5cblx0cHJpdmF0ZSBwYXJzZVhNTFJlc3BvbnNlID0gKHRleHQ6IHN0cmluZykgPT4ge1xuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCBkb2MgPSBuZXcgRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKHRleHQpO1xuXHRcdFx0Y29uc3Qgbm9kZXMgPSB4cGF0aC5zZWxlY3QoJy8vcHJlLypbbm90KHNlbGY6OmkpXS8vdGV4dCgpJywgZG9jKTtcblx0XHRcdHJldHVybiBub2Rlcy5sZW5ndGggPT09IDBcblx0XHRcdFx0PyBudWxsXG5cdFx0XHRcdDogbm9kZXMubWFwKChub2RlKSA9PiBub2RlLnRvU3RyaW5nKCkpLmpvaW4oJyAnKTtcblx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fTtcblxuXHRwdWJsaWMgdHJhbnNsYXRlQmF0Y2godGV4dDogc3RyaW5nW10sIGZyb206IGxhbmdDb2RlV2l0aEF1dG8sIHRvOiBsYW5nQ29kZSkge1xuXHRcdGNvbnN0IHByZXBhcmVkVGV4dCA9IHRoaXMuZW5jb2RlRm9yQmF0Y2godGV4dCk7XG5cdFx0cmV0dXJuIGdldFRva2VuKHByZXBhcmVkVGV4dC5qb2luKCcnKSkudGhlbigoeyB2YWx1ZTogdGsgfSkgPT4ge1xuXHRcdFx0Y29uc3QgYXBpUGF0aCA9ICdodHRwczovL3RyYW5zbGF0ZS5nb29nbGVhcGlzLmNvbS90cmFuc2xhdGVfYS90JztcblxuXHRcdFx0Y29uc3QgZGF0YSA9IHtcblx0XHRcdFx0YW5ubzogMyxcblx0XHRcdFx0Y2xpZW50OiAndGUnLFxuXHRcdFx0XHR2OiAnMS4wJyxcblx0XHRcdFx0Zm9ybWF0OiAnaHRtbCcsXG5cdFx0XHRcdHNsOiB0aGlzLmZpeExhbmcoZnJvbSksXG5cdFx0XHRcdHRsOiB0aGlzLmZpeExhbmcodG8pLFxuXHRcdFx0XHR0ayxcblx0XHRcdH07XG5cblx0XHRcdGNvbnN0IHVybCA9IGFwaVBhdGggKyAnPycgKyBzdHJpbmdpZnkoZGF0YSk7XG5cdFx0XHRjb25zdCBib2R5ID0gcHJlcGFyZWRUZXh0XG5cdFx0XHRcdC5tYXAoKHRleHQpID0+IGAmcT0ke2VuY29kZVVSSUNvbXBvbmVudCh0ZXh0KX1gKVxuXHRcdFx0XHQuam9pbignJyk7XG5cblx0XHRcdHJldHVybiBheGlvcyh7XG5cdFx0XHRcdHVybDogdGhpcy53cmFwVXJsVG9Db3JzUHJveHkodXJsKSxcblx0XHRcdFx0bWV0aG9kOiAnUE9TVCcsXG5cdFx0XHRcdHdpdGhDcmVkZW50aWFsczogZmFsc2UsXG5cdFx0XHRcdGhlYWRlcnM6IHtcblx0XHRcdFx0XHQnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcsXG5cdFx0XHRcdFx0Li4udGhpcy5vcHRpb25zLmhlYWRlcnMsXG5cdFx0XHRcdH0sXG5cdFx0XHRcdGRhdGE6IGJvZHksXG5cdFx0XHR9KVxuXHRcdFx0XHQudGhlbigocnNwKSA9PiByc3AuZGF0YSlcblx0XHRcdFx0LnRoZW4oKHJhd1Jlc3ApID0+IHtcblx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0aWYgKCFBcnJheS5pc0FycmF5KHJhd1Jlc3ApKSB7XG5cdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcignVW5leHBlY3RlZCByZXNwb25zZScpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRjb25zdCBpc1NpbmdsZVJlc3BvbnNlTW9kZSA9IHRleHQubGVuZ3RoID09PSAxO1xuXG5cdFx0XHRcdFx0XHRjb25zdCByZXN1bHQ6IHN0cmluZ1tdID0gW107XG5cdFx0XHRcdFx0XHR2aXNpdEFycmF5SXRlbXMocmF3UmVzcCwgKG9iaikgPT4ge1xuXHRcdFx0XHRcdFx0XHRpZiAoaXNTaW5nbGVSZXNwb25zZU1vZGUgJiYgcmVzdWx0Lmxlbmd0aCA9PT0gMSkgcmV0dXJuO1xuXG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2Ygb2JqICE9PSAnc3RyaW5nJykgcmV0dXJuO1xuXG5cdFx0XHRcdFx0XHRcdGlmIChpc1NpbmdsZVJlc3BvbnNlTW9kZSkge1xuXHRcdFx0XHRcdFx0XHRcdGNvbnN0IHBhcnNlZFRleHQgPSB0aGlzLnBhcnNlWE1MUmVzcG9uc2Uob2JqKTtcblx0XHRcdFx0XHRcdFx0XHRyZXN1bHQucHVzaChwYXJzZWRUZXh0IHx8IG9iaik7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0Y29uc3QgcGFyc2VkVGV4dCA9IHRoaXMucGFyc2VYTUxSZXNwb25zZShvYmopO1xuXHRcdFx0XHRcdFx0XHRcdGlmIChwYXJzZWRUZXh0ICE9PSBudWxsKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXN1bHQucHVzaChwYXJzZWRUZXh0KTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRpZiAocmVzdWx0Lmxlbmd0aCAhPT0gdGV4dC5sZW5ndGgpIHtcblx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFxuXHRcdFx0XHRcdFx0XHRcdCdNaXNtYXRjaGluZyBhIGxlbmd0aHMgb2Ygb3JpZ2luYWwgYW5kIHRyYW5zbGF0ZWQgYXJyYXlzJyxcblx0XHRcdFx0XHRcdFx0KTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0cmV0dXJuIHJlc3VsdCBhcyBzdHJpbmdbXTtcblx0XHRcdFx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUud2FybignR290IHJlc3BvbnNlJywgcmF3UmVzcCk7XG5cdFx0XHRcdFx0XHR0aHJvdyBlcnI7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHR9KTtcblx0fVxuXG5cdHByaXZhdGUgZW5jb2RlRm9yQmF0Y2godGV4dExpc3Q6IHN0cmluZ1tdKSB7XG5cdFx0cmV0dXJuIHRleHRMaXN0Lm1hcCgodGV4dCwgaSkgPT4gYDxwcmU+PGEgaT1cIiR7aX1cIj4ke3RleHR9PC9hPjwvcHJlPmApO1xuXHR9XG59XG5cbi8qKlxuICogVHJhbnNsYXRvciBpbXBsZW1lbnRhdGlvbiB3aGljaCB1c2UgR29vZ2xlIEFQSSB3aXRob3V0IHRva2VuXG4gKi9cbmV4cG9ydCBjbGFzcyBHb29nbGVUcmFuc2xhdG9yVG9rZW5GcmVlIGV4dGVuZHMgQWJzdHJhY3RHb29nbGVUcmFuc2xhdG9yIHtcblx0cHVibGljIHN0YXRpYyByZWFkb25seSB0cmFuc2xhdG9yTmFtZSA9ICdHb29nbGVUcmFuc2xhdG9yVG9rZW5GcmVlJztcblxuXHRwdWJsaWMgdHJhbnNsYXRlID0gYXN5bmMgKHRleHQ6IHN0cmluZywgZnJvbTogbGFuZ0NvZGVXaXRoQXV0bywgdG86IGxhbmdDb2RlKSA9PiB7XG5cdFx0Y29uc3QgW3RyYW5zbGF0aW9uXSA9IGF3YWl0IHRoaXMudHJhbnNsYXRlQmF0Y2goW3RleHRdLCBmcm9tLCB0byk7XG5cdFx0cmV0dXJuIHRyYW5zbGF0aW9uO1xuXHR9O1xuXG5cdHB1YmxpYyB0cmFuc2xhdGVCYXRjaCh0ZXh0OiBzdHJpbmdbXSwgZnJvbTogbGFuZ0NvZGVXaXRoQXV0bywgdG86IGxhbmdDb2RlKSB7XG5cdFx0Y29uc3QgYXBpUGF0aCA9ICdodHRwczovL3RyYW5zbGF0ZS5nb29nbGVhcGlzLmNvbS90cmFuc2xhdGVfYS90JztcblxuXHRcdGNvbnN0IGRhdGEgPSB7XG5cdFx0XHRjbGllbnQ6ICdkaWN0LWNocm9tZS1leCcsXG5cdFx0XHRzbDogdGhpcy5maXhMYW5nKGZyb20pLFxuXHRcdFx0dGw6IHRoaXMuZml4TGFuZyh0byksXG5cdFx0XHRxOiB0ZXh0LFxuXHRcdH07XG5cblx0XHRjb25zdCB1cmwgPSBhcGlQYXRoICsgJz8nICsgc3RyaW5naWZ5KGRhdGEpO1xuXG5cdFx0cmV0dXJuIGF4aW9zKHtcblx0XHRcdHVybDogdGhpcy53cmFwVXJsVG9Db3JzUHJveHkodXJsKSxcblx0XHRcdG1ldGhvZDogJ0dFVCcsXG5cdFx0XHR3aXRoQ3JlZGVudGlhbHM6IGZhbHNlLFxuXHRcdFx0aGVhZGVyczoge1xuXHRcdFx0XHQnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcsXG5cdFx0XHRcdC4uLnRoaXMub3B0aW9ucy5oZWFkZXJzLFxuXHRcdFx0fSxcblx0XHR9KVxuXHRcdFx0LnRoZW4oKHJzcCkgPT4gcnNwLmRhdGEpXG5cdFx0XHQudGhlbigocmF3UmVzcCkgPT4ge1xuXHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdGlmICghQXJyYXkuaXNBcnJheShyYXdSZXNwKSkge1xuXHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCdVbmV4cGVjdGVkIHJlc3BvbnNlJyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Y29uc3QgaW50ZXJtZWRpYXRlVGV4dHNBcnJheTogc3RyaW5nW10gPSBbXTtcblx0XHRcdFx0XHR2aXNpdEFycmF5SXRlbXMocmF3UmVzcCwgKG9iaikgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBvYmogPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRcdFx0XHRcdGludGVybWVkaWF0ZVRleHRzQXJyYXkucHVzaChvYmopO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0Y29uc3QgcmVzdWx0OiBzdHJpbmdbXSA9IFtdO1xuXG5cdFx0XHRcdFx0Y29uc3QgaXNTaW5nbGVSZXNwb25zZU1vZGUgPSB0ZXh0Lmxlbmd0aCA9PT0gMTtcblx0XHRcdFx0XHRjb25zdCBpc09uZVRvT25lTWFwcGluZ01vZGUgPVxuXHRcdFx0XHRcdFx0aW50ZXJtZWRpYXRlVGV4dHNBcnJheS5sZW5ndGggPT09IHRleHQubGVuZ3RoO1xuXHRcdFx0XHRcdGZvciAoY29uc3QgaWR4IGluIGludGVybWVkaWF0ZVRleHRzQXJyYXkpIHtcblx0XHRcdFx0XHRcdGNvbnN0IHRleHQgPSBpbnRlcm1lZGlhdGVUZXh0c0FycmF5W2lkeF07XG5cblx0XHRcdFx0XHRcdGlmIChpc1NpbmdsZVJlc3BvbnNlTW9kZSkge1xuXHRcdFx0XHRcdFx0XHRyZXN1bHQucHVzaCh0ZXh0KTtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdC8vIEVhY2ggc2Vjb25kIHRleHQgaXQncyBub3QgdHJhbnNsYXRpb24gaWYgbm90IDEtMSBtYXBwaW5nXG5cdFx0XHRcdFx0XHRjb25zdCBpc1RyYW5zbGF0aW9uID1cblx0XHRcdFx0XHRcdFx0aXNPbmVUb09uZU1hcHBpbmdNb2RlIHx8IE51bWJlcihpZHgpICUgMiA9PT0gMDtcblx0XHRcdFx0XHRcdGlmIChpc1RyYW5zbGF0aW9uKSB7XG5cdFx0XHRcdFx0XHRcdHJlc3VsdC5wdXNoKHRleHQpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChyZXN1bHQubGVuZ3RoICE9PSB0ZXh0Lmxlbmd0aCkge1xuXHRcdFx0XHRcdFx0Y29uc29sZS53YXJuKCdUcmFuc2xhdGlvbiByZXN1bHQnLCByZXN1bHQpO1xuXHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFxuXHRcdFx0XHRcdFx0XHQnTWlzbWF0Y2hpbmcgYSBsZW5ndGhzIG9mIG9yaWdpbmFsIGFuZCB0cmFuc2xhdGVkIGFycmF5cycsXG5cdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiByZXN1bHQgYXMgc3RyaW5nW107XG5cdFx0XHRcdH0gY2F0Y2ggKGVycikge1xuXHRcdFx0XHRcdGNvbnNvbGUud2FybignR290IHJlc3BvbnNlJywgcmF3UmVzcCk7XG5cdFx0XHRcdFx0dGhyb3cgZXJyO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0fVxufVxuIl0sImZpbGUiOiJ0cmFuc2xhdG9ycy9Hb29nbGVUcmFuc2xhdG9yL2luZGV4LmpzIn0=
