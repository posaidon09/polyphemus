"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getYandexSID = getYandexSID;
// Source: https://github.com/FilipePS/Traduzir-paginas-web/blob/f3a4956a1aa96b7a9124864158a5200827694521/background/translationService.js
var lastYandexRequestSIDTime = null;
var yandexTranslateSID = null;
var yandexSIDNotFound = false;

function getYandexSID() {
  return new Promise(function (resolve) {
    var updateYandexSid = false;

    if (lastYandexRequestSIDTime) {
      var date = new Date();

      if (yandexTranslateSID) {
        date.setHours(date.getHours() - 12);
      } else if (yandexSIDNotFound) {
        date.setMinutes(date.getMinutes() - 30);
      } else {
        date.setMinutes(date.getMinutes() - 2);
      }

      if (date.getTime() > lastYandexRequestSIDTime) {
        updateYandexSid = true;
      }
    } else {
      updateYandexSid = true;
    }

    if (updateYandexSid) {
      lastYandexRequestSIDTime = Date.now();
      var http_1 = new XMLHttpRequest();
      http_1.open('GET', 'https://translate.yandex.net/website-widget/v1/widget.js?widgetId=ytWidget&pageLang=es&widgetTheme=light&autoMode=false');
      http_1.send();

      http_1.onload = function () {
        var result = http_1.responseText.match(/sid\:\s\'[0-9a-f\.]+/);

        if (result && result[0] && result[0].length > 7) {
          yandexTranslateSID = result[0].substring(6);
          yandexSIDNotFound = false;
        } else {
          yandexSIDNotFound = true;
        }

        resolve();
      };

      http_1.onerror = function (e) {
        console.error(e);
        resolve();
      };
    } else {
      resolve();
    }
  }).then(function () {
    return yandexTranslateSID;
  });
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyYW5zbGF0b3JzL1lhbmRleFRyYW5zbGF0b3IvZ2V0WWFuZGV4U0lELnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBRUEsSUFBSSx3QkFBd0IsR0FBa0IsSUFBOUM7QUFDQSxJQUFJLGtCQUFrQixHQUFrQixJQUF4QztBQUNBLElBQUksaUJBQWlCLEdBQVksS0FBakM7O0FBRU0sU0FBVSxZQUFWLEdBQXNCO0FBQzNCLFNBQU8sSUFBSSxPQUFKLENBQWtCLFVBQUMsT0FBRCxFQUFRO0FBQ2hDLFFBQUksZUFBZSxHQUFHLEtBQXRCOztBQUNBLFFBQUksd0JBQUosRUFBOEI7QUFDN0IsVUFBTSxJQUFJLEdBQUcsSUFBSSxJQUFKLEVBQWI7O0FBQ0EsVUFBSSxrQkFBSixFQUF3QjtBQUN2QixRQUFBLElBQUksQ0FBQyxRQUFMLENBQWMsSUFBSSxDQUFDLFFBQUwsS0FBa0IsRUFBaEM7QUFDQSxPQUZELE1BRU8sSUFBSSxpQkFBSixFQUF1QjtBQUM3QixRQUFBLElBQUksQ0FBQyxVQUFMLENBQWdCLElBQUksQ0FBQyxVQUFMLEtBQW9CLEVBQXBDO0FBQ0EsT0FGTSxNQUVBO0FBQ04sUUFBQSxJQUFJLENBQUMsVUFBTCxDQUFnQixJQUFJLENBQUMsVUFBTCxLQUFvQixDQUFwQztBQUNBOztBQUNELFVBQUksSUFBSSxDQUFDLE9BQUwsS0FBaUIsd0JBQXJCLEVBQStDO0FBQzlDLFFBQUEsZUFBZSxHQUFHLElBQWxCO0FBQ0E7QUFDRCxLQVpELE1BWU87QUFDTixNQUFBLGVBQWUsR0FBRyxJQUFsQjtBQUNBOztBQUVELFFBQUksZUFBSixFQUFxQjtBQUNwQixNQUFBLHdCQUF3QixHQUFHLElBQUksQ0FBQyxHQUFMLEVBQTNCO0FBRUEsVUFBTSxNQUFJLEdBQUcsSUFBSSxjQUFKLEVBQWI7QUFDQSxNQUFBLE1BQUksQ0FBQyxJQUFMLENBQ0MsS0FERCxFQUVDLHlIQUZEO0FBSUEsTUFBQSxNQUFJLENBQUMsSUFBTDs7QUFDQSxNQUFBLE1BQUksQ0FBQyxNQUFMLEdBQWMsWUFBQTtBQUNiLFlBQU0sTUFBTSxHQUFHLE1BQUksQ0FBQyxZQUFMLENBQWtCLEtBQWxCLENBQXdCLHNCQUF4QixDQUFmOztBQUNBLFlBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxDQUFELENBQWhCLElBQXVCLE1BQU0sQ0FBQyxDQUFELENBQU4sQ0FBVSxNQUFWLEdBQW1CLENBQTlDLEVBQWlEO0FBQ2hELFVBQUEsa0JBQWtCLEdBQUcsTUFBTSxDQUFDLENBQUQsQ0FBTixDQUFVLFNBQVYsQ0FBb0IsQ0FBcEIsQ0FBckI7QUFDQSxVQUFBLGlCQUFpQixHQUFHLEtBQXBCO0FBQ0EsU0FIRCxNQUdPO0FBQ04sVUFBQSxpQkFBaUIsR0FBRyxJQUFwQjtBQUNBOztBQUNELFFBQUEsT0FBTztBQUNQLE9BVEQ7O0FBVUEsTUFBQSxNQUFJLENBQUMsT0FBTCxHQUFlLFVBQUMsQ0FBRCxFQUFFO0FBQ2hCLFFBQUEsT0FBTyxDQUFDLEtBQVIsQ0FBYyxDQUFkO0FBQ0EsUUFBQSxPQUFPO0FBQ1AsT0FIRDtBQUlBLEtBdkJELE1BdUJPO0FBQ04sTUFBQSxPQUFPO0FBQ1A7QUFDRCxHQTVDTSxFQTRDSixJQTVDSSxDQTRDQyxZQUFBO0FBQU0sV0FBQSxrQkFBQTtBQUFrQixHQTVDekIsQ0FBUDtBQTZDQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIFNvdXJjZTogaHR0cHM6Ly9naXRodWIuY29tL0ZpbGlwZVBTL1RyYWR1emlyLXBhZ2luYXMtd2ViL2Jsb2IvZjNhNDk1NmExYWE5NmI3YTkxMjQ4NjQxNThhNTIwMDgyNzY5NDUyMS9iYWNrZ3JvdW5kL3RyYW5zbGF0aW9uU2VydmljZS5qc1xuXG5sZXQgbGFzdFlhbmRleFJlcXVlc3RTSURUaW1lOiBudW1iZXIgfCBudWxsID0gbnVsbDtcbmxldCB5YW5kZXhUcmFuc2xhdGVTSUQ6IHN0cmluZyB8IG51bGwgPSBudWxsO1xubGV0IHlhbmRleFNJRE5vdEZvdW5kOiBib29sZWFuID0gZmFsc2U7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRZYW5kZXhTSUQoKSB7XG5cdHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSkgPT4ge1xuXHRcdGxldCB1cGRhdGVZYW5kZXhTaWQgPSBmYWxzZTtcblx0XHRpZiAobGFzdFlhbmRleFJlcXVlc3RTSURUaW1lKSB7XG5cdFx0XHRjb25zdCBkYXRlID0gbmV3IERhdGUoKTtcblx0XHRcdGlmICh5YW5kZXhUcmFuc2xhdGVTSUQpIHtcblx0XHRcdFx0ZGF0ZS5zZXRIb3VycyhkYXRlLmdldEhvdXJzKCkgLSAxMik7XG5cdFx0XHR9IGVsc2UgaWYgKHlhbmRleFNJRE5vdEZvdW5kKSB7XG5cdFx0XHRcdGRhdGUuc2V0TWludXRlcyhkYXRlLmdldE1pbnV0ZXMoKSAtIDMwKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGRhdGUuc2V0TWludXRlcyhkYXRlLmdldE1pbnV0ZXMoKSAtIDIpO1xuXHRcdFx0fVxuXHRcdFx0aWYgKGRhdGUuZ2V0VGltZSgpID4gbGFzdFlhbmRleFJlcXVlc3RTSURUaW1lKSB7XG5cdFx0XHRcdHVwZGF0ZVlhbmRleFNpZCA9IHRydWU7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHVwZGF0ZVlhbmRleFNpZCA9IHRydWU7XG5cdFx0fVxuXG5cdFx0aWYgKHVwZGF0ZVlhbmRleFNpZCkge1xuXHRcdFx0bGFzdFlhbmRleFJlcXVlc3RTSURUaW1lID0gRGF0ZS5ub3coKTtcblxuXHRcdFx0Y29uc3QgaHR0cCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXHRcdFx0aHR0cC5vcGVuKFxuXHRcdFx0XHQnR0VUJyxcblx0XHRcdFx0J2h0dHBzOi8vdHJhbnNsYXRlLnlhbmRleC5uZXQvd2Vic2l0ZS13aWRnZXQvdjEvd2lkZ2V0LmpzP3dpZGdldElkPXl0V2lkZ2V0JnBhZ2VMYW5nPWVzJndpZGdldFRoZW1lPWxpZ2h0JmF1dG9Nb2RlPWZhbHNlJyxcblx0XHRcdCk7XG5cdFx0XHRodHRwLnNlbmQoKTtcblx0XHRcdGh0dHAub25sb2FkID0gKCkgPT4ge1xuXHRcdFx0XHRjb25zdCByZXN1bHQgPSBodHRwLnJlc3BvbnNlVGV4dC5tYXRjaCgvc2lkXFw6XFxzXFwnWzAtOWEtZlxcLl0rLyk7XG5cdFx0XHRcdGlmIChyZXN1bHQgJiYgcmVzdWx0WzBdICYmIHJlc3VsdFswXS5sZW5ndGggPiA3KSB7XG5cdFx0XHRcdFx0eWFuZGV4VHJhbnNsYXRlU0lEID0gcmVzdWx0WzBdLnN1YnN0cmluZyg2KTtcblx0XHRcdFx0XHR5YW5kZXhTSUROb3RGb3VuZCA9IGZhbHNlO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHlhbmRleFNJRE5vdEZvdW5kID0gdHJ1ZTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHR9O1xuXHRcdFx0aHR0cC5vbmVycm9yID0gKGUpID0+IHtcblx0XHRcdFx0Y29uc29sZS5lcnJvcihlKTtcblx0XHRcdFx0cmVzb2x2ZSgpO1xuXHRcdFx0fTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmVzb2x2ZSgpO1xuXHRcdH1cblx0fSkudGhlbigoKSA9PiB5YW5kZXhUcmFuc2xhdGVTSUQpO1xufVxuIl0sImZpbGUiOiJ0cmFuc2xhdG9ycy9ZYW5kZXhUcmFuc2xhdG9yL2dldFlhbmRleFNJRC5qcyJ9
