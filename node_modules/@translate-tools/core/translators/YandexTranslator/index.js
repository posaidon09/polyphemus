"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.YandexTranslator = void 0;

var _queryString = require("query-string");

var _lodash = require("lodash");

var _BaseTranslator = require("../../util/BaseTranslator");

var _fetchResponseToJson = require("../../lib/fetchResponseToJson");

var _getYandexSID = require("./getYandexSID");

var __extends = void 0 && (void 0).__extends || function () {
  var extendStatics = function (d, b) {
    extendStatics = Object.setPrototypeOf || {
      __proto__: []
    } instanceof Array && function (d, b) {
      d.__proto__ = b;
    } || function (d, b) {
      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];
    };

    return extendStatics(d, b);
  };

  return function (d, b) {
    if (typeof b !== "function" && b !== null) throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
    extendStatics(d, b);

    function __() {
      this.constructor = d;
    }

    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
  };
}();

var __assign = void 0 && (void 0).__assign || function () {
  __assign = Object.assign || function (t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
      s = arguments[i];

      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
    }

    return t;
  };

  return __assign.apply(this, arguments);
};

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  function adopt(value) {
    return value instanceof P ? value : new P(function (resolve) {
      resolve(value);
    });
  }

  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

var __generator = void 0 && (void 0).__generator || function (thisArg, body) {
  var _ = {
    label: 0,
    sent: function () {
      if (t[0] & 1) throw t[1];
      return t[1];
    },
    trys: [],
    ops: []
  },
      f,
      y,
      t,
      g;
  return g = {
    next: verb(0),
    "throw": verb(1),
    "return": verb(2)
  }, typeof Symbol === "function" && (g[Symbol.iterator] = function () {
    return this;
  }), g;

  function verb(n) {
    return function (v) {
      return step([n, v]);
    };
  }

  function step(op) {
    if (f) throw new TypeError("Generator is already executing.");

    while (_) try {
      if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
      if (y = 0, t) op = [op[0] & 2, t.value];

      switch (op[0]) {
        case 0:
        case 1:
          t = op;
          break;

        case 4:
          _.label++;
          return {
            value: op[1],
            done: false
          };

        case 5:
          _.label++;
          y = op[1];
          op = [0];
          continue;

        case 7:
          op = _.ops.pop();

          _.trys.pop();

          continue;

        default:
          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _ = 0;
            continue;
          }

          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {
            _.label = op[1];
            break;
          }

          if (op[0] === 6 && _.label < t[1]) {
            _.label = t[1];
            t = op;
            break;
          }

          if (t && _.label < t[2]) {
            _.label = t[2];

            _.ops.push(op);

            break;
          }

          if (t[2]) _.ops.pop();

          _.trys.pop();

          continue;
      }

      op = body.call(thisArg, _);
    } catch (e) {
      op = [6, e];
      y = 0;
    } finally {
      f = t = 0;
    }

    if (op[0] & 5) throw op[1];
    return {
      value: op[0] ? op[1] : void 0,
      done: true
    };
  }
};

var __values = void 0 && (void 0).__values || function (o) {
  var s = typeof Symbol === "function" && Symbol.iterator,
      m = s && o[s],
      i = 0;
  if (m) return m.call(o);
  if (o && typeof o.length === "number") return {
    next: function () {
      if (o && i >= o.length) o = void 0;
      return {
        value: o && o[i++],
        done: !o
      };
    }
  };
  throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
};

var YandexTranslator =
/** @class */
function (_super) {
  __extends(YandexTranslator, _super);

  function YandexTranslator() {
    return _super !== null && _super.apply(this, arguments) || this;
  }

  YandexTranslator.isSupportedAutoFrom = function () {
    return true;
  };

  YandexTranslator.getSupportedLanguages = function () {
    // Supported, but not valid languages ['mhr', 'pap', 'ceb', 'mrj', 'udm']
    // eslint-disable
    // prettier-ignore
    return ['az', 'ml', 'sq', 'mt', 'am', 'mk', 'en', 'mi', 'ar', 'mr', 'hy', 'af', 'mn', 'eu', 'de', 'ba', 'ne', 'be', 'no', 'bn', 'pa', 'my', 'bg', 'fa', 'bs', 'pl', 'cy', 'pt', 'hu', 'ro', 'vi', 'ru', 'ht', 'gl', 'sr', 'nl', 'si', 'sk', 'el', 'sl', 'ka', 'sw', 'gu', 'su', 'da', 'tg', 'he', 'th', 'yi', 'tl', 'id', 'ta', 'ga', 'tt', 'it', 'te', 'is', 'tr', 'es', 'kk', 'uz', 'kn', 'uk', 'ca', 'ur', 'ky', 'fi', 'zh', 'fr', 'ko', 'hi', 'xh', 'hr', 'km', 'cs', 'lo', 'sv', 'la', 'gd', 'lv', 'et', 'lt', 'eo', 'lb', 'jv', 'mg', 'ja', 'ms']; // eslint-enable
  };

  YandexTranslator.prototype.getLengthLimit = function () {
    return 4000;
  };

  YandexTranslator.prototype.getRequestsTimeout = function () {
    return 500;
  };

  YandexTranslator.prototype.checkLimitExceeding = function (text) {
    if (Array.isArray(text)) {
      var arrayLen = text.reduce(function (acc, text) {
        return acc + text.length;
      }, 0);
      var extra = arrayLen - this.getLengthLimit();
      return extra > 0 ? extra : 0;
    } else {
      var extra = text.length - this.getLengthLimit();
      return extra > 0 ? extra : 0;
    }
  };

  YandexTranslator.prototype.translate = function (text, from, to) {
    return __awaiter(this, void 0, void 0, function () {
      return __generator(this, function (_a) {
        return [2
        /*return*/
        , this.translateBatch([text], from, to).then(function (resp) {
          return resp[0];
        })];
      });
    });
  };

  YandexTranslator.prototype.translateBatch = function (text, from, to) {
    return __awaiter(this, void 0, void 0, function () {
      var sid, options, body, text_1, text_1_1, textChunk, urlWithSid;

      var e_1, _a;

      return __generator(this, function (_b) {
        switch (_b.label) {
          case 0:
            return [4
            /*yield*/
            , (0, _getYandexSID.getYandexSID)()];

          case 1:
            sid = _b.sent();

            if (sid === null) {
              throw new Error('Invalid SID');
            }

            options = {
              format: 'html',
              lang: from === 'auto' ? to : "".concat(from, "-").concat(to)
            };
            body = (0, _queryString.stringify)(options);

            try {
              for (text_1 = __values(text), text_1_1 = text_1.next(); !text_1_1.done; text_1_1 = text_1.next()) {
                textChunk = text_1_1.value;
                body += '&text=' + encodeURIComponent(textChunk);
              }
            } catch (e_1_1) {
              e_1 = {
                error: e_1_1
              };
            } finally {
              try {
                if (text_1_1 && !text_1_1.done && (_a = text_1.return)) _a.call(text_1);
              } finally {
                if (e_1) throw e_1.error;
              }
            }

            urlWithSid = 'https://translate.yandex.net/api/v1/tr.json/translate?srv=tr-url-widget&id=' + sid + '-0-0&';
            return [2
            /*return*/
            , fetch(this.wrapUrlToCorsProxy(urlWithSid + body), {
              method: 'GET',
              credentials: 'omit',
              referrerPolicy: 'no-referrer',
              headers: __assign({
                'Content-Type': 'application/x-www-form-urlencoded'
              }, this.options.headers)
            }).then(_fetchResponseToJson.fetchResponseToJson).then(function (resp) {
              if (!(resp instanceof Object) || !Array.isArray(resp.text) || resp.text.length !== text.length) {
                throw new Error('Unexpected response');
              }

              return resp.text.map(function (text) {
                if (typeof text !== 'string') {
                  throw new Error('Unexpected response type');
                }

                return (0, _lodash.unescape)(text);
              });
            })];
        }
      });
    });
  };

  YandexTranslator.translatorName = 'YandexTranslator';
  return YandexTranslator;
}(_BaseTranslator.BaseTranslator);

exports.YandexTranslator = YandexTranslator;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyYW5zbGF0b3JzL1lhbmRleFRyYW5zbGF0b3IvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUdBOztBQUNBOztBQUVBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUEsSUFBQSxnQkFBQTtBQUFBO0FBQUEsVUFBQSxNQUFBLEVBQUE7QUFBc0MsRUFBQSxTQUFBLENBQUEsZ0JBQUEsRUFBQSxNQUFBLENBQUE7O0FBQXRDLFdBQUEsZ0JBQUEsR0FBQTs7QUFtR0M7O0FBaEdjLEVBQUEsZ0JBQUEsQ0FBQSxtQkFBQSxHQUFkLFlBQUE7QUFDQyxXQUFPLElBQVA7QUFDQSxHQUZhOztBQUlBLEVBQUEsZ0JBQUEsQ0FBQSxxQkFBQSxHQUFkLFlBQUE7QUFDQztBQUVBO0FBQ0E7QUFDQSxXQUFPLENBQ04sSUFETSxFQUNBLElBREEsRUFDTSxJQUROLEVBQ1ksSUFEWixFQUNrQixJQURsQixFQUN3QixJQUR4QixFQUM4QixJQUQ5QixFQUNvQyxJQURwQyxFQUMwQyxJQUQxQyxFQUNnRCxJQURoRCxFQUVOLElBRk0sRUFFQSxJQUZBLEVBRU0sSUFGTixFQUVZLElBRlosRUFFa0IsSUFGbEIsRUFFd0IsSUFGeEIsRUFFOEIsSUFGOUIsRUFFb0MsSUFGcEMsRUFFMEMsSUFGMUMsRUFFZ0QsSUFGaEQsRUFHTixJQUhNLEVBR0EsSUFIQSxFQUdNLElBSE4sRUFHWSxJQUhaLEVBR2tCLElBSGxCLEVBR3dCLElBSHhCLEVBRzhCLElBSDlCLEVBR29DLElBSHBDLEVBRzBDLElBSDFDLEVBR2dELElBSGhELEVB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Q0FBQyxJQUFMLENBQVUsTUFBVixLQUFxQixJQUFJLENBQUMsTUFIM0IsRUFJRTtBQUNELHNCQUFNLElBQUksS0FBSixDQUFVLHFCQUFWLENBQU47QUFDQTs7QUFFRCxxQkFBTyxJQUFJLENBQUMsSUFBTCxDQUFVLEdBQVYsQ0FBYyxVQUFDLElBQUQsRUFBVTtBQUM5QixvQkFBSSxPQUFPLElBQVAsS0FBZ0IsUUFBcEIsRUFBOEI7QUFDN0Isd0JBQU0sSUFBSSxLQUFKLENBQVUsMEJBQVYsQ0FBTjtBQUNBOztBQUVELHVCQUFPLHNCQUFTLElBQVQsQ0FBUDtBQUNBLGVBTk0sQ0FBUDtBQU9BLGFBMUJLLENBQVAsQ0FBQTs7OztBQTJCQSxHQWpEWTs7QUFoRFUsRUFBQSxnQkFBQSxDQUFBLGNBQUEsR0FBaUIsa0JBQWpCO0FBa0d4QixTQUFBLGdCQUFBO0FBQUMsQ0FuR0QsQ0FBc0MsOEJBQXRDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzdHJpbmdpZnkgfSBmcm9tICdxdWVyeS1zdHJpbmcnO1xuaW1wb3J0IHsgdW5lc2NhcGUgfSBmcm9tICdsb2Rhc2gnO1xuXG5pbXBvcnQgeyBsYW5nQ29kZSwgbGFuZ0NvZGVXaXRoQXV0byB9IGZyb20gJy4uLy4uL3R5cGVzL1RyYW5zbGF0b3InO1xuaW1wb3J0IHsgQmFzZVRyYW5zbGF0b3IgfSBmcm9tICcuLi8uLi91dGlsL0Jhc2VUcmFuc2xhdG9yJztcbmltcG9ydCB7IGZldGNoUmVzcG9uc2VUb0pzb24gfSBmcm9tICcuLi8uLi9saWIvZmV0Y2hSZXNwb25zZVRvSnNvbic7XG5cbmltcG9ydCB7IGdldFlhbmRleFNJRCB9IGZyb20gJy4vZ2V0WWFuZGV4U0lEJztcblxuZXhwb3J0IGNsYXNzIFlhbmRleFRyYW5zbGF0b3IgZXh0ZW5kcyBCYXNlVHJhbnNsYXRvciB7XG5cdHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgdHJhbnNsYXRvck5hbWUgPSAnWWFuZGV4VHJhbnNsYXRvcic7XG5cblx0cHVibGljIHN0YXRpYyBpc1N1cHBvcnRlZEF1dG9Gcm9tKCkge1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG5cblx0cHVibGljIHN0YXRpYyBnZXRTdXBwb3J0ZWRMYW5ndWFnZXMoKTogbGFuZ0NvZGVbXSB7XG5cdFx0Ly8gU3VwcG9ydGVkLCBidXQgbm90IHZhbGlkIGxhbmd1YWdlcyBbJ21ocicsICdwYXAnLCAnY2ViJywgJ21yaicsICd1ZG0nXVxuXG5cdFx0Ly8gZXNsaW50LWRpc2FibGVcblx0XHQvLyBwcmV0dGllci1pZ25vcmVcblx0XHRyZXR1cm4gW1xuXHRcdFx0J2F6JywgJ21sJywgJ3NxJywgJ210JywgJ2FtJywgJ21rJywgJ2VuJywgJ21pJywgJ2FyJywgJ21yJyxcblx0XHRcdCdoeScsICdhZicsICdtbicsICdldScsICdkZScsICdiYScsICduZScsICdiZScsICdubycsICdibicsXG5cdFx0XHQncGEnLCAnbXknLCAnYmcnLCAnZmEnLCAnYnMnLCAncGwnLCAnY3knLCAncHQnLCAnaHUnLCAncm8nLFxuXHRcdFx0J3ZpJywgJ3J1JywgJ2h0JywgJ2dsJywgJ3NyJywgJ25sJywgJ3NpJywgJ3NrJywgJ2VsJywgJ3NsJyxcblx0XHRcdCdrYScsICdzdycsICdndScsICdzdScsICdkYScsICd0ZycsICdoZScsICd0aCcsICd5aScsICd0bCcsXG5cdFx0XHQnaWQnLCAndGEnLCAnZ2EnLCAndHQnLCAnaXQnLCAndGUnLCAnaXMnLCAndHInLCAnZXMnLCAna2snLFxuXHRcdFx0J3V6JywgJ2tuJywgJ3VrJywgJ2NhJywgJ3VyJywgJ2t5JywgJ2ZpJywgJ3poJywgJ2ZyJywgJ2tvJyxcblx0XHRcdCdoaScsICd4aCcsICdocicsICdrbScsICdjcycsICdsbycsICdzdicsICdsYScsICdnZCcsICdsdicsXG5cdFx0XHQnZXQnLCAnbHQnLCAnZW8nLCAnbGInLCAnanYnLCAnbWcnLCAnamEnLCAnbXMnLFxuXHRcdF07XG5cdFx0Ly8gZXNsaW50LWVuYWJsZVxuXHR9XG5cblx0cHVibGljIGdldExlbmd0aExpbWl0KCkge1xuXHRcdHJldHVybiA0MDAwO1xuXHR9XG5cblx0cHVibGljIGdldFJlcXVlc3RzVGltZW91dCgpIHtcblx0XHRyZXR1cm4gNTAwO1xuXHR9XG5cblx0cHVibGljIGNoZWNrTGltaXRFeGNlZWRpbmcodGV4dDogc3RyaW5nIHwgc3RyaW5nW10pIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheSh0ZXh0KSkge1xuXHRcdFx0Y29uc3QgYXJyYXlMZW4gPSB0ZXh0LnJlZHVjZSgoYWNjLCB0ZXh0KSA9PiBhY2MgKyB0ZXh0Lmxlbmd0aCwgMCk7XG5cdFx0XHRjb25zdCBleHRyYSA9IGFycmF5TGVuIC0gdGhpcy5nZXRMZW5ndGhMaW1pdCgpO1xuXHRcdFx0cmV0dXJuIGV4dHJhID4gMCA/IGV4dHJhIDogMDtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29uc3QgZXh0cmEgPSB0ZXh0Lmxlbmd0aCAtIHRoaXMuZ2V0TGVuZ3RoTGltaXQoKTtcblx0XHRcdHJldHVybiBleHRyYSA+IDAgPyBleHRyYSA6IDA7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGFzeW5jIHRyYW5zbGF0ZSh0ZXh0OiBzdHJpbmcsIGZyb206IGxhbmdDb2RlV2l0aEF1dG8sIHRvOiBsYW5nQ29kZSkge1xuXHRcdHJldHVybiB0aGlzLnRyYW5zbGF0ZUJhdGNoKFt0ZXh0XSwgZnJvbSwgdG8pLnRoZW4oKHJlc3ApID0+IHJlc3BbMF0pO1xuXHR9XG5cblx0cHVibGljIGFzeW5jIHRyYW5zbGF0ZUJhdGNoKHRleHQ6IHN0cmluZ1tdLCBmcm9tOiBsYW5nQ29kZVdpdGhBdXRvLCB0bzogbGFuZ0NvZGUpIHtcblx0XHRjb25zdCBzaWQgPSBhd2FpdCBnZXRZYW5kZXhTSUQoKTtcblx0XHRpZiAoc2lkID09PSBudWxsKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgU0lEJyk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qgb3B0aW9ucyA9IHtcblx0XHRcdGZvcm1hdDogJ2h0bWwnLFxuXHRcdFx0bGFuZzogZnJvbSA9PT0gJ2F1dG8nID8gdG8gOiBgJHtmcm9tfS0ke3RvfWAsXG5cdFx0fTtcblxuXHRcdGxldCBib2R5ID0gc3RyaW5naWZ5KG9wdGlvbnMpO1xuXHRcdGZvciAoY29uc3QgdGV4dENodW5rIG9mIHRleHQpIHtcblx0XHRcdGJvZHkgKz0gJyZ0ZXh0PScgKyBlbmNvZGVVUklDb21wb25lbnQodGV4dENodW5rKTtcblx0XHR9XG5cblx0XHQvLyBOT1RFOiBpZiBzZXJ2aWNlIHdpbGwgcmVzaXN0IGFuZCB3aWxsIG5vdCB3b3JrLCBpdCBtYXkgY2hlY2sgb3JkZXIgb2YgaGVhZGVycywgcGFyYW1ldGVycyBhbmQgcmVxdWVzdHNcblx0XHQvLyBpbiB0aGlzIGNhc2UganVzdCBtYWtlIHJlcXVlc3RzIGxlc3Mgc3BlY2lmaWMgdG8gaXQgbG9va3MgbGlrZSByZXF1ZXN0cyBmcm9tIHR5cGljYWwgcGFnZSAod2l0aCBvdmVyaGVhZCByZXF1ZXN0cyBpZiByZXF1aXJlKVxuXHRcdGNvbnN0IHVybFdpdGhTaWQgPVxuXHRcdFx0J2h0dHBzOi8vdHJhbnNsYXRlLnlhbmRleC5uZXQvYXBpL3YxL3RyLmpzb24vdHJhbnNsYXRlP3Nydj10ci11cmwtd2lkZ2V0JmlkPScgK1xuXHRcdFx0c2lkICtcblx0XHRcdCctMC0wJic7XG5cdFx0cmV0dXJuIGZldGNoKHRoaXMud3JhcFVybFRvQ29yc1Byb3h5KHVybFdpdGhTaWQgKyBib2R5KSwge1xuXHRcdFx0bWV0aG9kOiAnR0VUJyxcblx0XHRcdGNyZWRlbnRpYWxzOiAnb21pdCcsXG5cdFx0XHRyZWZlcnJlclBvbGljeTogJ25vLXJlZmVycmVyJyxcblx0XHRcdGhlYWRlcnM6IHtcblx0XHRcdFx0J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnLFxuXHRcdFx0XHQuLi50aGlzLm9wdGlvbnMuaGVhZGVycyxcblx0XHRcdH0sXG5cdFx0fSlcblx0XHRcdC50aGVuKGZldGNoUmVzcG9uc2VUb0pzb24pXG5cdFx0XHQudGhlbigocmVzcCkgPT4ge1xuXHRcdFx0XHRpZiAoXG5cdFx0XHRcdFx0IShyZXNwIGluc3RhbmNlb2YgT2JqZWN0KSB8fFxuXHRcdFx0XHRcdCFBcnJheS5pc0FycmF5KHJlc3AudGV4dCkgfHxcblx0XHRcdFx0XHRyZXNwLnRleHQubGVuZ3RoICE9PSB0ZXh0Lmxlbmd0aFxuXHRcdFx0XHQpIHtcblx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ1VuZXhwZWN0ZWQgcmVzcG9uc2UnKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByZXNwLnRleHQubWFwKCh0ZXh0OiBhbnkpID0+IHtcblx0XHRcdFx0XHRpZiAodHlwZW9mIHRleHQgIT09ICdzdHJpbmcnKSB7XG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ1VuZXhwZWN0ZWQgcmVzcG9uc2UgdHlwZScpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiB1bmVzY2FwZSh0ZXh0KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0fVxufVxuIl0sImZpbGUiOiJ0cmFuc2xhdG9ycy9ZYW5kZXhUcmFuc2xhdG9yL2luZGV4LmpzIn0=
