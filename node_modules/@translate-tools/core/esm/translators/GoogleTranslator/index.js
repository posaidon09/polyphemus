var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __read = (this && this.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};
import axios from 'axios';
import { stringify } from 'query-string';
import xpath from 'xpath';
import { DOMParser } from '@xmldom/xmldom';
import { BaseTranslator } from '../../util/BaseTranslator';
import { getToken } from './token';
import { visitArrayItems } from './utils';
/**
 * Common class for google translator implementations
 */
var AbstractGoogleTranslator = /** @class */ (function (_super) {
    __extends(AbstractGoogleTranslator, _super);
    function AbstractGoogleTranslator() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.langReplacements = {
            zh: 'zh-cn',
        };
        return _this;
    }
    AbstractGoogleTranslator.isSupportedAutoFrom = function () {
        return true;
    };
    AbstractGoogleTranslator.getSupportedLanguages = function () {
        // Supported, but not valid languages ["zh-cn", "zh-tw", 'ceb', 'haw', 'iw', 'hmn', 'jw', 'ma']
        // eslint-disable
        // prettier-ignore
        return [
            'af', 'sq', 'am', 'ar', 'hy', 'az', 'eu', 'be', 'bn', 'bs',
            'bg', 'ca', 'ny', 'co', 'hr', 'cs', 'da', 'nl', 'en', 'eo',
            'et', 'tl', 'fi', 'fr', 'fy', 'gl', 'ka', 'de', 'el', 'gu',
            'ht', 'ha', 'hi', 'hu', 'is', 'ig', 'id', 'ga', 'it', 'ja',
            'kn', 'kk', 'km', 'ko', 'ku', 'ky', 'lo', 'la', 'lv', 'lt',
            'lb', 'mk', 'mg', 'ms', 'ml', 'mt', 'mi', 'mr', 'mn', 'my',
            'ne', 'no', 'ps', 'fa', 'pl', 'pt', 'pa', 'ro', 'ru', 'sm',
            'gd', 'sr', 'st', 'sn', 'sd', 'si', 'sk', 'sl', 'so', 'es',
            'su', 'sw', 'sv', 'tg', 'ta', 'te', 'th', 'tr', 'uk', 'ur',
            'uz', 'vi', 'cy', 'xh', 'yi', 'yo', 'zu', 'zh',
        ];
        // eslint-enable
    };
    AbstractGoogleTranslator.prototype.getLengthLimit = function () {
        return 4000;
    };
    AbstractGoogleTranslator.prototype.getRequestsTimeout = function () {
        return 300;
    };
    AbstractGoogleTranslator.prototype.fixLang = function (lang) {
        return lang in this.langReplacements ? this.langReplacements[lang] : lang;
    };
    return AbstractGoogleTranslator;
}(BaseTranslator));
export { AbstractGoogleTranslator };
/**
 * Translator implementation which use Google API with token from https://translate.google.com
 */
var GoogleTranslator = /** @class */ (function (_super) {
    __extends(GoogleTranslator, _super);
    function GoogleTranslator() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.parseXMLResponse = function (text) {
            try {
                var doc = new DOMParser().parseFromString(text);
                var nodes = xpath.select('//pre/*[not(self::i)]//text()', doc);
                return nodes.length === 0
                    ? null
                    : nodes.map(function (node) { return node.toString(); }).join(' ');
            }
            catch (err) {
                return null;
            }
        };
        return _this;
    }
    GoogleTranslator.prototype.checkLimitExceeding = function (text) {
        if (Array.isArray(text)) {
            var encodedText = this.encodeForBatch(text).join('');
            var extra = encodedText.length - this.getLengthLimit();
            return extra > 0 ? extra : 0;
        }
        else {
            var extra = text.length - this.getLengthLimit();
            return extra > 0 ? extra : 0;
        }
    };
    GoogleTranslator.prototype.translate = function (text, from, to) {
        var _this = this;
        return getToken(text).then(function (_a) {
            var tk = _a.value;
            var apiPath = 'https://translate.google.com/translate_a/single';
            var data = {
                client: 't',
                sl: _this.fixLang(from),
                tl: _this.fixLang(to),
                hl: _this.fixLang(to),
                dt: ['at', 'bd', 'ex', 'ld', 'md', 'qca', 'rw', 'rm', 'ss', 't'],
                ie: 'UTF-8',
                oe: 'UTF-8',
                otf: 1,
                ssel: 0,
                tsel: 0,
                kc: 7,
                q: text,
                tk: tk,
            };
            var url = apiPath + '?' + stringify(data);
            return axios
                .get(_this.wrapUrlToCorsProxy(url), {
                withCredentials: false,
                headers: _this.options.headers,
            })
                .then(function (rsp) { return rsp.data; })
                .then(function (rsp) {
                if (!(rsp instanceof Array) || !(rsp[0] instanceof Array)) {
                    throw new Error('Unexpected response');
                }
                var translatedText = rsp[0]
                    .map(function (chunk) {
                    return chunk instanceof Array && typeof chunk[0] === 'string'
                        ? chunk[0]
                        : '';
                })
                    .join('');
                return translatedText;
            });
        });
    };
    GoogleTranslator.prototype.translateBatch = function (text, from, to) {
        var _this = this;
        var preparedText = this.encodeForBatch(text);
        return getToken(preparedText.join('')).then(function (_a) {
            var tk = _a.value;
            var apiPath = 'https://translate.googleapis.com/translate_a/t';
            var data = {
                anno: 3,
                client: 'te',
                v: '1.0',
                format: 'html',
                sl: _this.fixLang(from),
                tl: _this.fixLang(to),
                tk: tk,
            };
            var url = apiPath + '?' + stringify(data);
            var body = preparedText
                .map(function (text) { return "&q=".concat(encodeURIComponent(text)); })
                .join('');
            return axios({
                url: _this.wrapUrlToCorsProxy(url),
                method: 'POST',
                withCredentials: false,
                headers: __assign({ 'Content-Type': 'application/x-www-form-urlencoded' }, _this.options.headers),
                data: body,
            })
                .then(function (rsp) { return rsp.data; })
                .then(function (rawResp) {
                try {
                    if (!Array.isArray(rawResp)) {
                        throw new Error('Unexpected response');
                    }
                    var isSingleResponseMode_1 = text.length === 1;
                    var result_1 = [];
                    visitArrayItems(rawResp, function (obj) {
                        if (isSingleResponseMode_1 && result_1.length === 1)
                            return;
                        if (typeof obj !== 'string')
                            return;
                        if (isSingleResponseMode_1) {
                            var parsedText = _this.parseXMLResponse(obj);
                            result_1.push(parsedText || obj);
                        }
                        else {
                            var parsedText = _this.parseXMLResponse(obj);
                            if (parsedText !== null) {
                                result_1.push(parsedText);
                            }
                        }
                    });
                    if (result_1.length !== text.length) {
                        throw new Error('Mismatching a lengths of original and translated arrays');
                    }
                    return result_1;
                }
                catch (err) {
                    console.warn('Got response', rawResp);
                    throw err;
                }
            });
        });
    };
    GoogleTranslator.prototype.encodeForBatch = function (textList) {
        return textList.map(function (text, i) { return "<pre><a i=\"".concat(i, "\">").concat(text, "</a></pre>"); });
    };
    GoogleTranslator.translatorName = 'GoogleTranslator';
    return GoogleTranslator;
}(AbstractGoogleTranslator));
export { GoogleTranslator };
/**
 * Translator implementation which use Google API without token
 */
var GoogleTranslatorTokenFree = /** @class */ (function (_super) {
    __extends(GoogleTranslatorTokenFree, _super);
    function GoogleTranslatorTokenFree() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.translate = function (text, from, to) { return __awaiter(_this, void 0, void 0, function () {
            var _a, translation;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0: return [4 /*yield*/, this.translateBatch([text], from, to)];
                    case 1:
                        _a = __read.apply(void 0, [_b.sent(), 1]), translation = _a[0];
                        return [2 /*return*/, translation];
                }
            });
        }); };
        return _this;
    }
    GoogleTranslatorTokenFree.prototype.translateBatch = function (text, from, to) {
        var apiPath = 'https://translate.googleapis.com/translate_a/t';
        var data = {
            client: 'dict-chrome-ex',
            sl: this.fixLang(from),
            tl: this.fixLang(to),
            q: text,
        };
        var url = apiPath + '?' + stringify(data);
        return axios({
            url: this.wrapUrlToCorsProxy(url),
            method: 'GET',
            withCredentials: false,
            headers: __assign({ 'Content-Type': 'application/x-www-form-urlencoded' }, this.options.headers),
        })
            .then(function (rsp) { return rsp.data; })
            .then(function (rawResp) {
            try {
                if (!Array.isArray(rawResp)) {
                    throw new Error('Unexpected response');
                }
                var intermediateTextsArray_1 = [];
                visitArrayItems(rawResp, function (obj) {
                    if (typeof obj === 'string') {
                        intermediateTextsArray_1.push(obj);
                    }
                });
                var result = [];
                var isSingleResponseMode = text.length === 1;
                var isOneToOneMappingMode = intermediateTextsArray_1.length === text.length;
                for (var idx in intermediateTextsArray_1) {
                    var text_1 = intermediateTextsArray_1[idx];
                    if (isSingleResponseMode) {
                        result.push(text_1);
                        break;
                    }
                    // Each second text it's not translation if not 1-1 mapping
                    var isTranslation = isOneToOneMappingMode || Number(idx) % 2 === 0;
                    if (isTranslation) {
                        result.push(text_1);
                    }
                }
                if (result.length !== text.length) {
                    console.warn('Translation result', result);
                    throw new Error('Mismatching a lengths of original and translated arrays');
                }
                return result;
            }
            catch (err) {
                console.warn('Got response', rawResp);
                throw err;
            }
        });
    };
    GoogleTranslatorTokenFree.translatorName = 'GoogleTranslatorTokenFree';
    return GoogleTranslatorTokenFree;
}(AbstractGoogleTranslator));
export { GoogleTranslatorTokenFree };

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyYW5zbGF0b3JzL0dvb2dsZVRyYW5zbGF0b3IvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsT0FBTyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQzFCLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDekMsT0FBTyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQzFCLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUczQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDM0QsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUNuQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBRTFDOztHQUVHO0FBQ0g7SUFBdUQsNENBQWM7SUFBckU7UUFBQSxxRUF3Q0M7UUFQbUIsc0JBQWdCLEdBQTJCO1lBQzdELEVBQUUsRUFBRSxPQUFPO1NBQ1gsQ0FBQzs7SUFLSCxDQUFDO0lBdkNjLDRDQUFtQixHQUFqQztRQUNDLE9BQU8sSUFBSSxDQUFDO0lBQ2IsQ0FBQztJQUVhLDhDQUFxQixHQUFuQztRQUNDLCtGQUErRjtRQUUvRixpQkFBaUI7UUFDakIsa0JBQWtCO1FBQ2xCLE9BQU87WUFDTixJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJO1lBQzFELElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUk7WUFDMUQsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSTtZQUMxRCxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJO1lBQzFELElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUk7WUFDMUQsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSTtZQUMxRCxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJO1lBQzFELElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUk7WUFDMUQsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSTtZQUMxRCxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSTtTQUM5QyxDQUFDO1FBQ0YsZ0JBQWdCO0lBQ2pCLENBQUM7SUFFTSxpREFBYyxHQUFyQjtRQUNDLE9BQU8sSUFBSSxDQUFDO0lBQ2IsQ0FBQztJQUVNLHFEQUFrQixHQUF6QjtRQUNDLE9BQU8sR0FBRyxDQUFDO0lBQ1osQ0FBQztJQU1TLDBDQUFPLEdBQWpCLFVBQWtCLElBQXNCO1FBQ3ZDLE9BQU8sSUFBSSxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDM0UsQ0FBQztJQUNGLCtCQUFDO0FBQUQsQ0F4Q0EsQUF3Q0MsQ0F4Q3NELGNBQWMsR0F3Q3BFOztBQUVEOztHQUVHO0FBQ0g7SUFBc0Msb0NBQXdCO0lBQTlEO1FBQUEscUVBa0pDO1FBdEZRLHNCQUFnQixHQUFHLFVBQUMsSUFBWTtZQUN2QyxJQUFJO2dCQUNILElBQU0sR0FBRyxHQUFHLElBQUksU0FBUyxFQUFFLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNsRCxJQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLCtCQUErQixFQUFFLEdBQUcsQ0FBQyxDQUFDO2dCQUNqRSxPQUFPLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQztvQkFDeEIsQ0FBQyxDQUFDLElBQUk7b0JBQ04sQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsVUFBQyxJQUFJLElBQUssT0FBQSxJQUFJLENBQUMsUUFBUSxFQUFFLEVBQWYsQ0FBZSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ2xEO1lBQUMsT0FBTyxHQUFHLEVBQUU7Z0JBQ2IsT0FBTyxJQUFJLENBQUM7YUFDWjtRQUNGLENBQUMsQ0FBQzs7SUE0RUgsQ0FBQztJQS9JTyw4Q0FBbUIsR0FBMUIsVUFBMkIsSUFBdUI7UUFDakQsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3hCLElBQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ3ZELElBQU0sS0FBSyxHQUFHLFdBQVcsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ3pELE9BQU8sS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDN0I7YUFBTTtZQUNOLElBQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ2xELE9BQU8sS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDN0I7SUFDRixDQUFDO0lBRU0sb0NBQVMsR0FBaEIsVUFBaUIsSUFBWSxFQUFFLElBQXNCLEVBQUUsRUFBWTtRQUFuRSxpQkE0Q0M7UUEzQ0EsT0FBTyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUMsRUFBYTtnQkFBSixFQUFFLFdBQUE7WUFDdEMsSUFBTSxPQUFPLEdBQUcsaURBQWlELENBQUM7WUFFbEUsSUFBTSxJQUFJLEdBQUc7Z0JBQ1osTUFBTSxFQUFFLEdBQUc7Z0JBQ1gsRUFBRSxFQUFFLEtBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO2dCQUN0QixFQUFFLEVBQUUsS0FBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7Z0JBQ3BCLEVBQUUsRUFBRSxLQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztnQkFDcEIsRUFBRSxFQUFFLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDO2dCQUNoRSxFQUFFLEVBQUUsT0FBTztnQkFDWCxFQUFFLEVBQUUsT0FBTztnQkFDWCxHQUFHLEVBQUUsQ0FBQztnQkFDTixJQUFJLEVBQUUsQ0FBQztnQkFDUCxJQUFJLEVBQUUsQ0FBQztnQkFDUCxFQUFFLEVBQUUsQ0FBQztnQkFDTCxDQUFDLEVBQUUsSUFBSTtnQkFDUCxFQUFFLElBQUE7YUFDRixDQUFDO1lBRUYsSUFBTSxHQUFHLEdBQUcsT0FBTyxHQUFHLEdBQUcsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFNUMsT0FBTyxLQUFLO2lCQUNWLEdBQUcsQ0FBQyxLQUFJLENBQUMsa0JBQWtCLENBQUMsR0FBRyxDQUFDLEVBQUU7Z0JBQ2xDLGVBQWUsRUFBRSxLQUFLO2dCQUN0QixPQUFPLEVBQUUsS0FBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPO2FBQzdCLENBQUM7aUJBQ0QsSUFBSSxDQUFDLFVBQUMsR0FBRyxJQUFLLE9BQUEsR0FBRyxDQUFDLElBQUksRUFBUixDQUFRLENBQUM7aUJBQ3ZCLElBQUksQ0FBQyxVQUFDLEdBQUc7Z0JBQ1QsSUFBSSxDQUFDLENBQUMsR0FBRyxZQUFZLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLFlBQVksS0FBSyxDQUFDLEVBQUU7b0JBQzFELE1BQU0sSUFBSSxLQUFLLENBQUMscUJBQXFCLENBQUMsQ0FBQztpQkFDdkM7Z0JBRUQsSUFBTSxjQUFjLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQztxQkFDM0IsR0FBRyxDQUFDLFVBQUMsS0FBSztvQkFDVixPQUFBLEtBQUssWUFBWSxLQUFLLElBQUksT0FBTyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssUUFBUTt3QkFDckQsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7d0JBQ1YsQ0FBQyxDQUFDLEVBQUU7Z0JBRkwsQ0FFSyxDQUNMO3FCQUNBLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFFWCxPQUFPLGNBQWMsQ0FBQztZQUN2QixDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0osQ0FBQztJQWNNLHlDQUFjLEdBQXJCLFVBQXNCLElBQWMsRUFBRSxJQUFzQixFQUFFLEVBQVk7UUFBMUUsaUJBcUVDO1FBcEVBLElBQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDL0MsT0FBTyxRQUFRLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFDLEVBQWE7Z0JBQUosRUFBRSxXQUFBO1lBQ3ZELElBQU0sT0FBTyxHQUFHLGdEQUFnRCxDQUFDO1lBRWpFLElBQU0sSUFBSSxHQUFHO2dCQUNaLElBQUksRUFBRSxDQUFDO2dCQUNQLE1BQU0sRUFBRSxJQUFJO2dCQUNaLENBQUMsRUFBRSxLQUFLO2dCQUNSLE1BQU0sRUFBRSxNQUFNO2dCQUNkLEVBQUUsRUFBRSxLQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQztnQkFDdEIsRUFBRSxFQUFFLEtBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO2dCQUNwQixFQUFFLElBQUE7YUFDRixDQUFDO1lBRUYsSUFBTSxHQUFHLEdBQUcsT0FBTyxHQUFHLEdBQUcsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDNUMsSUFBTSxJQUFJLEdBQUcsWUFBWTtpQkFDdkIsR0FBRyxDQUFDLFVBQUMsSUFBSSxJQUFLLE9BQUEsYUFBTSxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsQ0FBRSxFQUFoQyxDQUFnQyxDQUFDO2lCQUMvQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFWCxPQUFPLEtBQUssQ0FBQztnQkFDWixHQUFHLEVBQUUsS0FBSSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsQ0FBQztnQkFDakMsTUFBTSxFQUFFLE1BQU07Z0JBQ2QsZUFBZSxFQUFFLEtBQUs7Z0JBQ3RCLE9BQU8sYUFDTixjQUFjLEVBQUUsbUNBQW1DLElBQ2hELEtBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUN2QjtnQkFDRCxJQUFJLEVBQUUsSUFBSTthQUNWLENBQUM7aUJBQ0EsSUFBSSxDQUFDLFVBQUMsR0FBRyxJQUFLLE9BQUEsR0FBRyxDQUFDLElBQUksRUFBUixDQUFRLENBQUM7aUJBQ3ZCLElBQUksQ0FBQyxVQUFDLE9BQU87Z0JBQ2IsSUFBSTtvQkFDSCxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRTt3QkFDNUIsTUFBTSxJQUFJLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO3FCQUN2QztvQkFFRCxJQUFNLHNCQUFvQixHQUFHLElBQUksQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDO29CQUUvQyxJQUFNLFFBQU0sR0FBYSxFQUFFLENBQUM7b0JBQzVCLGVBQWUsQ0FBQyxPQUFPLEVBQUUsVUFBQyxHQUFHO3dCQUM1QixJQUFJLHNCQUFvQixJQUFJLFFBQU0sQ0FBQyxNQUFNLEtBQUssQ0FBQzs0QkFBRSxPQUFPO3dCQUV4RCxJQUFJLE9BQU8sR0FBRyxLQUFLLFFBQVE7NEJBQUUsT0FBTzt3QkFFcEMsSUFBSSxzQkFBb0IsRUFBRTs0QkFDekIsSUFBTSxVQUFVLEdBQUcsS0FBSSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxDQUFDOzRCQUM5QyxRQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsSUFBSSxHQUFHLENBQUMsQ0FBQzt5QkFDL0I7NkJBQU07NEJBQ04sSUFBTSxVQUFVLEdBQUcsS0FBSSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxDQUFDOzRCQUM5QyxJQUFJLFVBQVUsS0FBSyxJQUFJLEVBQUU7Z0NBQ3hCLFFBQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7NkJBQ3hCO3lCQUNEO29CQUNGLENBQUMsQ0FBQyxDQUFDO29CQUVILElBQUksUUFBTSxDQUFDLE1BQU0sS0FBSyxJQUFJLENBQUMsTUFBTSxFQUFFO3dCQUNsQyxNQUFNLElBQUksS0FBSyxDQUNkLHlEQUF5RCxDQUN6RCxDQUFDO3FCQUNGO29CQUVELE9BQU8sUUFBa0IsQ0FBQztpQkFDMUI7Z0JBQUMsT0FBTyxHQUFHLEVBQUU7b0JBQ2IsT0FBTyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsT0FBTyxDQUFDLENBQUM7b0JBQ3RDLE1BQU0sR0FBRyxDQUFDO2lCQUNWO1lBQ0YsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNKLENBQUM7SUFFTyx5Q0FBYyxHQUF0QixVQUF1QixRQUFrQjtRQUN4QyxPQUFPLFFBQVEsQ0FBQyxHQUFHLENBQUMsVUFBQyxJQUFJLEVBQUUsQ0FBQyxJQUFLLE9BQUEsc0JBQWMsQ0FBQyxnQkFBSyxJQUFJLGVBQVksRUFBcEMsQ0FBb0MsQ0FBQyxDQUFDO0lBQ3hFLENBQUM7SUFoSnNCLCtCQUFjLEdBQUcsa0JBQWtCLENBQUM7SUFpSjVELHVCQUFDO0NBbEpELEFBa0pDLENBbEpxQyx3QkFBd0IsR0FrSjdEO1NBbEpZLGdCQUFnQjtBQW9KN0I7O0dBRUc7QUFDSDtJQUErQyw2Q0FBd0I7SUFBdkU7UUFBQSxxRUE4RUM7UUEzRU8sZUFBUyxHQUFHLFVBQU8sSUFBWSxFQUFFLElBQXNCLEVBQUUsRUFBWTs7Ozs0QkFDckQscUJBQU0sSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFLENBQUMsRUFBQTs7d0JBQTNELEtBQUEsc0JBQWdCLFNBQTJDLEtBQUEsRUFBMUQsV0FBVyxRQUFBO3dCQUNsQixzQkFBTyxXQUFXLEVBQUM7OzthQUNuQixDQUFDOztJQXdFSCxDQUFDO0lBdEVPLGtEQUFjLEdBQXJCLFVBQXNCLElBQWMsRUFBRSxJQUFzQixFQUFFLEVBQVk7UUFDekUsSUFBTSxPQUFPLEdBQUcsZ0RBQWdELENBQUM7UUFFakUsSUFBTSxJQUFJLEdBQUc7WUFDWixNQUFNLEVBQUUsZ0JBQWdCO1lBQ3hCLEVBQUUsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQztZQUN0QixFQUFFLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDcEIsQ0FBQyxFQUFFLElBQUk7U0FDUCxDQUFDO1FBRUYsSUFBTSxHQUFHLEdBQUcsT0FBTyxHQUFHLEdBQUcsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFNUMsT0FBTyxLQUFLLENBQUM7WUFDWixHQUFHLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsQ0FBQztZQUNqQyxNQUFNLEVBQUUsS0FBSztZQUNiLGVBQWUsRUFBRSxLQUFLO1lBQ3RCLE9BQU8sYUFDTixjQUFjLEVBQUUsbUNBQW1DLElBQ2hELElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUN2QjtTQUNELENBQUM7YUFDQSxJQUFJLENBQUMsVUFBQyxHQUFHLElBQUssT0FBQSxHQUFHLENBQUMsSUFBSSxFQUFSLENBQVEsQ0FBQzthQUN2QixJQUFJLENBQUMsVUFBQyxPQUFPO1lBQ2IsSUFBSTtnQkFDSCxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRTtvQkFDNUIsTUFBTSxJQUFJLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO2lCQUN2QztnQkFFRCxJQUFNLHdCQUFzQixHQUFhLEVBQUUsQ0FBQztnQkFDNUMsZUFBZSxDQUFDLE9BQU8sRUFBRSxVQUFDLEdBQUc7b0JBQzVCLElBQUksT0FBTyxHQUFHLEtBQUssUUFBUSxFQUFFO3dCQUM1Qix3QkFBc0IsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7cUJBQ2pDO2dCQUNGLENBQUMsQ0FBQyxDQUFDO2dCQUVILElBQU0sTUFBTSxHQUFhLEVBQUUsQ0FBQztnQkFFNUIsSUFBTSxvQkFBb0IsR0FBRyxJQUFJLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztnQkFDL0MsSUFBTSxxQkFBcUIsR0FDMUIsd0JBQXNCLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxNQUFNLENBQUM7Z0JBQy9DLEtBQUssSUFBTSxHQUFHLElBQUksd0JBQXNCLEVBQUU7b0JBQ3pDLElBQU0sTUFBSSxHQUFHLHdCQUFzQixDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUV6QyxJQUFJLG9CQUFvQixFQUFFO3dCQUN6QixNQUFNLENBQUMsSUFBSSxDQUFDLE1BQUksQ0FBQyxDQUFDO3dCQUNsQixNQUFNO3FCQUNOO29CQUVELDJEQUEyRDtvQkFDM0QsSUFBTSxhQUFhLEdBQ2xCLHFCQUFxQixJQUFJLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUNoRCxJQUFJLGFBQWEsRUFBRTt3QkFDbEIsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFJLENBQUMsQ0FBQztxQkFDbEI7aUJBQ0Q7Z0JBRUQsSUFBSSxNQUFNLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxNQUFNLEVBQUU7b0JBQ2xDLE9BQU8sQ0FBQyxJQUFJLENBQUMsb0JBQW9CLEVBQUUsTUFBTSxDQUFDLENBQUM7b0JBQzNDLE1BQU0sSUFBSSxLQUFLLENBQ2QseURBQXlELENBQ3pELENBQUM7aUJBQ0Y7Z0JBRUQsT0FBTyxNQUFrQixDQUFDO2FBQzFCO1lBQUMsT0FBTyxHQUFHLEVBQUU7Z0JBQ2IsT0FBTyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsT0FBTyxDQUFDLENBQUM7Z0JBQ3RDLE1BQU0sR0FBRyxDQUFDO2FBQ1Y7UUFDRixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUE1RXNCLHdDQUFjLEdBQUcsMkJBQTJCLENBQUM7SUE2RXJFLGdDQUFDO0NBOUVELEFBOEVDLENBOUU4Qyx3QkFBd0IsR0E4RXRFO1NBOUVZLHlCQUF5QiIsImZpbGUiOiJ0cmFuc2xhdG9ycy9Hb29nbGVUcmFuc2xhdG9yL2luZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcbmltcG9ydCB7IHN0cmluZ2lmeSB9IGZyb20gJ3F1ZXJ5LXN0cmluZyc7XG5pbXBvcnQgeHBhdGggZnJvbSAneHBhdGgnO1xuaW1wb3J0IHsgRE9NUGFyc2VyIH0gZnJvbSAnQHhtbGRvbS94bWxkb20nO1xuXG5pbXBvcnQgeyBsYW5nQ29kZSwgbGFuZ0NvZGVXaXRoQXV0byB9IGZyb20gJy4uLy4uL3R5cGVzL1RyYW5zbGF0b3InO1xuaW1wb3J0IHsgQmFzZVRyYW5zbGF0b3IgfSBmcm9tICcuLi8uLi91dGlsL0Jhc2VUcmFuc2xhdG9yJztcbmltcG9ydCB7IGdldFRva2VuIH0gZnJvbSAnLi90b2tlbic7XG5pbXBvcnQgeyB2aXNpdEFycmF5SXRlbXMgfSBmcm9tICcuL3V0aWxzJztcblxuLyoqXG4gKiBDb21tb24gY2xhc3MgZm9yIGdvb2dsZSB0cmFuc2xhdG9yIGltcGxlbWVudGF0aW9uc1xuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQWJzdHJhY3RHb29nbGVUcmFuc2xhdG9yIGV4dGVuZHMgQmFzZVRyYW5zbGF0b3Ige1xuXHRwdWJsaWMgc3RhdGljIGlzU3VwcG9ydGVkQXV0b0Zyb20oKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRwdWJsaWMgc3RhdGljIGdldFN1cHBvcnRlZExhbmd1YWdlcygpOiBsYW5nQ29kZVtdIHtcblx0XHQvLyBTdXBwb3J0ZWQsIGJ1dCBub3QgdmFsaWQgbGFuZ3VhZ2VzIFtcInpoLWNuXCIsIFwiemgtdHdcIiwgJ2NlYicsICdoYXcnLCAnaXcnLCAnaG1uJywgJ2p3JywgJ21hJ11cblxuXHRcdC8vIGVzbGludC1kaXNhYmxlXG5cdFx0Ly8gcHJldHRpZXItaWdub3JlXG5cdFx0cmV0dXJuIFtcblx0XHRcdCdhZicsICdzcScsICdhbScsICdhcicsICdoeScsICdheicsICdldScsICdiZScsICdibicsICdicycsXG5cdFx0XHQnYmcnLCAnY2EnLCAnbnknLCAnY28nLCAnaHInLCAnY3MnLCAnZGEnLCAnbmwnLCAnZW4nLCAnZW8nLFxuXHRcdFx0J2V0JywgJ3RsJywgJ2ZpJywgJ2ZyJywgJ2Z5JywgJ2dsJywgJ2thJywgJ2RlJywgJ2VsJywgJ2d1Jyxcblx0XHRcdCdodCcsICdoYScsICdoaScsICdodScsICdpcycsICdpZycsICdpZCcsICdnYScsICdpdCcsICdqYScsXG5cdFx0XHQna24nLCAna2snLCAna20nLCAna28nLCAna3UnLCAna3knLCAnbG8nLCAnbGEnLCAnbHYnLCAnbHQnLFxuXHRcdFx0J2xiJywgJ21rJywgJ21nJywgJ21zJywgJ21sJywgJ210JywgJ21pJywgJ21yJywgJ21uJywgJ215Jyxcblx0XHRcdCduZScsICdubycsICdwcycsICdmYScsICdwbCcsICdwdCcsICdwYScsICdybycsICdydScsICdzbScsXG5cdFx0XHQnZ2QnLCAnc3InLCAnc3QnLCAnc24nLCAnc2QnLCAnc2knLCAnc2snLCAnc2wnLCAnc28nLCAnZXMnLFxuXHRcdFx0J3N1JywgJ3N3JywgJ3N2JywgJ3RnJywgJ3RhJywgJ3RlJywgJ3RoJywgJ3RyJywgJ3VrJywgJ3VyJyxcblx0XHRcdCd1eicsICd2aScsICdjeScsICd4aCcsICd5aScsICd5bycsICd6dScsICd6aCcsXG5cdFx0XTtcblx0XHQvLyBlc2xpbnQtZW5hYmxlXG5cdH1cblxuXHRwdWJsaWMgZ2V0TGVuZ3RoTGltaXQoKSB7XG5cdFx0cmV0dXJuIDQwMDA7XG5cdH1cblxuXHRwdWJsaWMgZ2V0UmVxdWVzdHNUaW1lb3V0KCkge1xuXHRcdHJldHVybiAzMDA7XG5cdH1cblxuXHRwcm90ZWN0ZWQgcmVhZG9ubHkgbGFuZ1JlcGxhY2VtZW50czogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcblx0XHR6aDogJ3poLWNuJyxcblx0fTtcblxuXHRwcm90ZWN0ZWQgZml4TGFuZyhsYW5nOiBsYW5nQ29kZVdpdGhBdXRvKSB7XG5cdFx0cmV0dXJuIGxhbmcgaW4gdGhpcy5sYW5nUmVwbGFjZW1lbnRzID8gdGhpcy5sYW5nUmVwbGFjZW1lbnRzW2xhbmddIDogbGFuZztcblx0fVxufVxuXG4vKipcbiAqIFRyYW5zbGF0b3IgaW1wbGVtZW50YXRpb24gd2hpY2ggdXNlIEdvb2dsZSBBUEkgd2l0aCB0b2tlbiBmcm9tIGh0dHBzOi8vdHJhbnNsYXRlLmdvb2dsZS5jb21cbiAqL1xuZXhwb3J0IGNsYXNzIEdvb2dsZVRyYW5zbGF0b3IgZXh0ZW5kcyBBYnN0cmFjdEdvb2dsZVRyYW5zbGF0b3Ige1xuXHRwdWJsaWMgc3RhdGljIHJlYWRvbmx5IHRyYW5zbGF0b3JOYW1lID0gJ0dvb2dsZVRyYW5zbGF0b3InO1xuXG5cdHB1YmxpYyBjaGVja0xpbWl0RXhjZWVkaW5nKHRleHQ6IHN0cmluZyB8IHN0cmluZ1tdKSB7XG5cdFx0aWYgKEFycmF5LmlzQXJyYXkodGV4dCkpIHtcblx0XHRcdGNvbnN0IGVuY29kZWRUZXh0ID0gdGhpcy5lbmNvZGVGb3JCYXRjaCh0ZXh0KS5qb2luKCcnKTtcblx0XHRcdGNvbnN0IGV4dHJhID0gZW5jb2RlZFRleHQubGVuZ3RoIC0gdGhpcy5nZXRMZW5ndGhMaW1pdCgpO1xuXHRcdFx0cmV0dXJuIGV4dHJhID4gMCA/IGV4dHJhIDogMDtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29uc3QgZXh0cmEgPSB0ZXh0Lmxlbmd0aCAtIHRoaXMuZ2V0TGVuZ3RoTGltaXQoKTtcblx0XHRcdHJldHVybiBleHRyYSA+IDAgPyBleHRyYSA6IDA7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIHRyYW5zbGF0ZSh0ZXh0OiBzdHJpbmcsIGZyb206IGxhbmdDb2RlV2l0aEF1dG8sIHRvOiBsYW5nQ29kZSkge1xuXHRcdHJldHVybiBnZXRUb2tlbih0ZXh0KS50aGVuKCh7IHZhbHVlOiB0ayB9KSA9PiB7XG5cdFx0XHRjb25zdCBhcGlQYXRoID0gJ2h0dHBzOi8vdHJhbnNsYXRlLmdvb2dsZS5jb20vdHJhbnNsYXRlX2Evc2luZ2xlJztcblxuXHRcdFx0Y29uc3QgZGF0YSA9IHtcblx0XHRcdFx0Y2xpZW50OiAndCcsXG5cdFx0XHRcdHNsOiB0aGlzLmZpeExhbmcoZnJvbSksXG5cdFx0XHRcdHRsOiB0aGlzLmZpeExhbmcodG8pLFxuXHRcdFx0XHRobDogdGhpcy5maXhMYW5nKHRvKSxcblx0XHRcdFx0ZHQ6IFsnYXQnLCAnYmQnLCAnZXgnLCAnbGQnLCAnbWQnLCAncWNhJywgJ3J3JywgJ3JtJywgJ3NzJywgJ3QnXSxcblx0XHRcdFx0aWU6ICdVVEYtOCcsXG5cdFx0XHRcdG9lOiAnVVRGLTgnLFxuXHRcdFx0XHRvdGY6IDEsXG5cdFx0XHRcdHNzZWw6IDAsXG5cdFx0XHRcdHRzZWw6IDAsXG5cdFx0XHRcdGtjOiA3LFxuXHRcdFx0XHRxOiB0ZXh0LFxuXHRcdFx0XHR0ayxcblx0XHRcdH07XG5cblx0XHRcdGNvbnN0IHVybCA9IGFwaVBhdGggKyAnPycgKyBzdHJpbmdpZnkoZGF0YSk7XG5cblx0XHRcdHJldHVybiBheGlvc1xuXHRcdFx0XHQuZ2V0KHRoaXMud3JhcFVybFRvQ29yc1Byb3h5KHVybCksIHtcblx0XHRcdFx0XHR3aXRoQ3JlZGVudGlhbHM6IGZhbHNlLFxuXHRcdFx0XHRcdGhlYWRlcnM6IHRoaXMub3B0aW9ucy5oZWFkZXJzLFxuXHRcdFx0XHR9KVxuXHRcdFx0XHQudGhlbigocnNwKSA9PiByc3AuZGF0YSlcblx0XHRcdFx0LnRoZW4oKHJzcCkgPT4ge1xuXHRcdFx0XHRcdGlmICghKHJzcCBpbnN0YW5jZW9mIEFycmF5KSB8fCAhKHJzcFswXSBpbnN0YW5jZW9mIEFycmF5KSkge1xuXHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCdVbmV4cGVjdGVkIHJlc3BvbnNlJyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Y29uc3QgdHJhbnNsYXRlZFRleHQgPSByc3BbMF1cblx0XHRcdFx0XHRcdC5tYXAoKGNodW5rKSA9PlxuXHRcdFx0XHRcdFx0XHRjaHVuayBpbnN0YW5jZW9mIEFycmF5ICYmIHR5cGVvZiBjaHVua1swXSA9PT0gJ3N0cmluZydcblx0XHRcdFx0XHRcdFx0XHQ/IGNodW5rWzBdXG5cdFx0XHRcdFx0XHRcdFx0OiAnJyxcblx0XHRcdFx0XHRcdClcblx0XHRcdFx0XHRcdC5qb2luKCcnKTtcblxuXHRcdFx0XHRcdHJldHVybiB0cmFuc2xhdGVkVGV4dDtcblx0XHRcdFx0fSk7XG5cdFx0fSk7XG5cdH1cblxuXHRwcml2YXRlIHBhcnNlWE1MUmVzcG9uc2UgPSAodGV4dDogc3RyaW5nKSA9PiB7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IGRvYyA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcodGV4dCk7XG5cdFx0XHRjb25zdCBub2RlcyA9IHhwYXRoLnNlbGVjdCgnLy9wcmUvKltub3Qoc2VsZjo6aSldLy90ZXh0KCknLCBkb2MpO1xuXHRcdFx0cmV0dXJuIG5vZGVzLmxlbmd0aCA9PT0gMFxuXHRcdFx0XHQ/IG51bGxcblx0XHRcdFx0OiBub2Rlcy5tYXAoKG5vZGUpID0+IG5vZGUudG9TdHJpbmcoKSkuam9pbignICcpO1xuXHRcdH0gY2F0Y2ggKGVycikge1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9O1xuXG5cdHB1YmxpYyB0cmFuc2xhdGVCYXRjaCh0ZXh0OiBzdHJpbmdbXSwgZnJvbTogbGFuZ0NvZGVXaXRoQXV0bywgdG86IGxhbmdDb2RlKSB7XG5cdFx0Y29uc3QgcHJlcGFyZWRUZXh0ID0gdGhpcy5lbmNvZGVGb3JCYXRjaCh0ZXh0KTtcblx0XHRyZXR1cm4gZ2V0VG9rZW4ocHJlcGFyZWRUZXh0LmpvaW4oJycpKS50aGVuKCh7IHZhbHVlOiB0ayB9KSA9PiB7XG5cdFx0XHRjb25zdCBhcGlQYXRoID0gJ2h0dHBzOi8vdHJhbnNsYXRlLmdvb2dsZWFwaXMuY29tL3RyYW5zbGF0ZV9hL3QnO1xuXG5cdFx0XHRjb25zdCBkYXRhID0ge1xuXHRcdFx0XHRhbm5vOiAzLFxuXHRcdFx0XHRjbGllbnQ6ICd0ZScsXG5cdFx0XHRcdHY6ICcxLjAnLFxuXHRcdFx0XHRmb3JtYXQ6ICdodG1sJyxcblx0XHRcdFx0c2w6IHRoaXMuZml4TGFuZyhmcm9tKSxcblx0XHRcdFx0dGw6IHRoaXMuZml4TGFuZyh0byksXG5cdFx0XHRcdHRrLFxuXHRcdFx0fTtcblxuXHRcdFx0Y29uc3QgdXJsID0gYXBpUGF0aCArICc/JyArIHN0cmluZ2lmeShkYXRhKTtcblx0XHRcdGNvbnN0IGJvZHkgPSBwcmVwYXJlZFRleHRcblx0XHRcdFx0Lm1hcCgodGV4dCkgPT4gYCZxPSR7ZW5jb2RlVVJJQ29tcG9uZW50KHRleHQpfWApXG5cdFx0XHRcdC5qb2luKCcnKTtcblxuXHRcdFx0cmV0dXJuIGF4aW9zKHtcblx0XHRcdFx0dXJsOiB0aGlzLndyYXBVcmxUb0NvcnNQcm94eSh1cmwpLFxuXHRcdFx0XHRtZXRob2Q6ICdQT1NUJyxcblx0XHRcdFx0d2l0aENyZWRlbnRpYWxzOiBmYWxzZSxcblx0XHRcdFx0aGVhZGVyczoge1xuXHRcdFx0XHRcdCdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyxcblx0XHRcdFx0XHQuLi50aGlzLm9wdGlvbnMuaGVhZGVycyxcblx0XHRcdFx0fSxcblx0XHRcdFx0ZGF0YTogYm9keSxcblx0XHRcdH0pXG5cdFx0XHRcdC50aGVuKChyc3ApID0+IHJzcC5kYXRhKVxuXHRcdFx0XHQudGhlbigocmF3UmVzcCkgPT4ge1xuXHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRpZiAoIUFycmF5LmlzQXJyYXkocmF3UmVzcCkpIHtcblx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCdVbmV4cGVjdGVkIHJlc3BvbnNlJyk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGNvbnN0IGlzU2luZ2xlUmVzcG9uc2VNb2RlID0gdGV4dC5sZW5ndGggPT09IDE7XG5cblx0XHRcdFx0XHRcdGNvbnN0IHJlc3VsdDogc3RyaW5nW10gPSBbXTtcblx0XHRcdFx0XHRcdHZpc2l0QXJyYXlJdGVtcyhyYXdSZXNwLCAob2JqKSA9PiB7XG5cdFx0XHRcdFx0XHRcdGlmIChpc1NpbmdsZVJlc3BvbnNlTW9kZSAmJiByZXN1bHQubGVuZ3RoID09PSAxKSByZXR1cm47XG5cblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBvYmogIT09ICdzdHJpbmcnKSByZXR1cm47XG5cblx0XHRcdFx0XHRcdFx0aWYgKGlzU2luZ2xlUmVzcG9uc2VNb2RlKSB7XG5cdFx0XHRcdFx0XHRcdFx0Y29uc3QgcGFyc2VkVGV4dCA9IHRoaXMucGFyc2VYTUxSZXNwb25zZShvYmopO1xuXHRcdFx0XHRcdFx0XHRcdHJlc3VsdC5wdXNoKHBhcnNlZFRleHQgfHwgb2JqKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRjb25zdCBwYXJzZWRUZXh0ID0gdGhpcy5wYXJzZVhNTFJlc3BvbnNlKG9iaik7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHBhcnNlZFRleHQgIT09IG51bGwpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJlc3VsdC5wdXNoKHBhcnNlZFRleHQpO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdGlmIChyZXN1bHQubGVuZ3RoICE9PSB0ZXh0Lmxlbmd0aCkge1xuXHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXG5cdFx0XHRcdFx0XHRcdFx0J01pc21hdGNoaW5nIGEgbGVuZ3RocyBvZiBvcmlnaW5hbCBhbmQgdHJhbnNsYXRlZCBhcnJheXMnLFxuXHRcdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0IGFzIHN0cmluZ1tdO1xuXHRcdFx0XHRcdH0gY2F0Y2ggKGVycikge1xuXHRcdFx0XHRcdFx0Y29uc29sZS53YXJuKCdHb3QgcmVzcG9uc2UnLCByYXdSZXNwKTtcblx0XHRcdFx0XHRcdHRocm93IGVycjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdH0pO1xuXHR9XG5cblx0cHJpdmF0ZSBlbmNvZGVGb3JCYXRjaCh0ZXh0TGlzdDogc3RyaW5nW10pIHtcblx0XHRyZXR1cm4gdGV4dExpc3QubWFwKCh0ZXh0LCBpKSA9PiBgPHByZT48YSBpPVwiJHtpfVwiPiR7dGV4dH08L2E+PC9wcmU+YCk7XG5cdH1cbn1cblxuLyoqXG4gKiBUcmFuc2xhdG9yIGltcGxlbWVudGF0aW9uIHdoaWNoIHVzZSBHb29nbGUgQVBJIHdpdGhvdXQgdG9rZW5cbiAqL1xuZXhwb3J0IGNsYXNzIEdvb2dsZVRyYW5zbGF0b3JUb2tlbkZyZWUgZXh0ZW5kcyBBYnN0cmFjdEdvb2dsZVRyYW5zbGF0b3Ige1xuXHRwdWJsaWMgc3RhdGljIHJlYWRvbmx5IHRyYW5zbGF0b3JOYW1lID0gJ0dvb2dsZVRyYW5zbGF0b3JUb2tlbkZyZWUnO1xuXG5cdHB1YmxpYyB0cmFuc2xhdGUgPSBhc3luYyAodGV4dDogc3RyaW5nLCBmcm9tOiBsYW5nQ29kZVdpdGhBdXRvLCB0bzogbGFuZ0NvZGUpID0+IHtcblx0XHRjb25zdCBbdHJhbnNsYXRpb25dID0gYXdhaXQgdGhpcy50cmFuc2xhdGVCYXRjaChbdGV4dF0sIGZyb20sIHRvKTtcblx0XHRyZXR1cm4gdHJhbnNsYXRpb247XG5cdH07XG5cblx0cHVibGljIHRyYW5zbGF0ZUJhdGNoKHRleHQ6IHN0cmluZ1tdLCBmcm9tOiBsYW5nQ29kZVdpdGhBdXRvLCB0bzogbGFuZ0NvZGUpIHtcblx0XHRjb25zdCBhcGlQYXRoID0gJ2h0dHBzOi8vdHJhbnNsYXRlLmdvb2dsZWFwaXMuY29tL3RyYW5zbGF0ZV9hL3QnO1xuXG5cdFx0Y29uc3QgZGF0YSA9IHtcblx0XHRcdGNsaWVudDogJ2RpY3QtY2hyb21lLWV4Jyxcblx0XHRcdHNsOiB0aGlzLmZpeExhbmcoZnJvbSksXG5cdFx0XHR0bDogdGhpcy5maXhMYW5nKHRvKSxcblx0XHRcdHE6IHRleHQsXG5cdFx0fTtcblxuXHRcdGNvbnN0IHVybCA9IGFwaVBhdGggKyAnPycgKyBzdHJpbmdpZnkoZGF0YSk7XG5cblx0XHRyZXR1cm4gYXhpb3Moe1xuXHRcdFx0dXJsOiB0aGlzLndyYXBVcmxUb0NvcnNQcm94eSh1cmwpLFxuXHRcdFx0bWV0aG9kOiAnR0VUJyxcblx0XHRcdHdpdGhDcmVkZW50aWFsczogZmFsc2UsXG5cdFx0XHRoZWFkZXJzOiB7XG5cdFx0XHRcdCdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyxcblx0XHRcdFx0Li4udGhpcy5vcHRpb25zLmhlYWRlcnMsXG5cdFx0XHR9LFxuXHRcdH0pXG5cdFx0XHQudGhlbigocnNwKSA9PiByc3AuZGF0YSlcblx0XHRcdC50aGVuKChyYXdSZXNwKSA9PiB7XG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0aWYgKCFBcnJheS5pc0FycmF5KHJhd1Jlc3ApKSB7XG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ1VuZXhwZWN0ZWQgcmVzcG9uc2UnKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRjb25zdCBpbnRlcm1lZGlhdGVUZXh0c0FycmF5OiBzdHJpbmdbXSA9IFtdO1xuXHRcdFx0XHRcdHZpc2l0QXJyYXlJdGVtcyhyYXdSZXNwLCAob2JqKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mIG9iaiA9PT0gJ3N0cmluZycpIHtcblx0XHRcdFx0XHRcdFx0aW50ZXJtZWRpYXRlVGV4dHNBcnJheS5wdXNoKG9iaik7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRjb25zdCByZXN1bHQ6IHN0cmluZ1tdID0gW107XG5cblx0XHRcdFx0XHRjb25zdCBpc1NpbmdsZVJlc3BvbnNlTW9kZSA9IHRleHQubGVuZ3RoID09PSAxO1xuXHRcdFx0XHRcdGNvbnN0IGlzT25lVG9PbmVNYXBwaW5nTW9kZSA9XG5cdFx0XHRcdFx0XHRpbnRlcm1lZGlhdGVUZXh0c0FycmF5Lmxlbmd0aCA9PT0gdGV4dC5sZW5ndGg7XG5cdFx0XHRcdFx0Zm9yIChjb25zdCBpZHggaW4gaW50ZXJtZWRpYXRlVGV4dHNBcnJheSkge1xuXHRcdFx0XHRcdFx0Y29uc3QgdGV4dCA9IGludGVybWVkaWF0ZVRleHRzQXJyYXlbaWR4XTtcblxuXHRcdFx0XHRcdFx0aWYgKGlzU2luZ2xlUmVzcG9uc2VNb2RlKSB7XG5cdFx0XHRcdFx0XHRcdHJlc3VsdC5wdXNoKHRleHQpO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0Ly8gRWFjaCBzZWNvbmQgdGV4dCBpdCdzIG5vdCB0cmFuc2xhdGlvbiBpZiBub3QgMS0xIG1hcHBpbmdcblx0XHRcdFx0XHRcdGNvbnN0IGlzVHJhbnNsYXRpb24gPVxuXHRcdFx0XHRcdFx0XHRpc09uZVRvT25lTWFwcGluZ01vZGUgfHwgTnVtYmVyKGlkeCkgJSAyID09PSAwO1xuXHRcdFx0XHRcdFx0aWYgKGlzVHJhbnNsYXRpb24pIHtcblx0XHRcdFx0XHRcdFx0cmVzdWx0LnB1c2godGV4dCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHJlc3VsdC5sZW5ndGggIT09IHRleHQubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oJ1RyYW5zbGF0aW9uIHJlc3VsdCcsIHJlc3VsdCk7XG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXG5cdFx0XHRcdFx0XHRcdCdNaXNtYXRjaGluZyBhIGxlbmd0aHMgb2Ygb3JpZ2luYWwgYW5kIHRyYW5zbGF0ZWQgYXJyYXlzJyxcblx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmV0dXJuIHJlc3VsdCBhcyBzdHJpbmdbXTtcblx0XHRcdFx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKCdHb3QgcmVzcG9uc2UnLCByYXdSZXNwKTtcblx0XHRcdFx0XHR0aHJvdyBlcnI7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHR9XG59XG4iXX0=
